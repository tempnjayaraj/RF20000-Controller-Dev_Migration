/*******************************************************************************
//                   ArthroCare Proprietary and Confidential
//                   (c) ArthroCare Corporation 2012
//                           All Rights Reserved
********************************************************************************
$Author:: Harshil.Shah      $:
$Rev:: 2834                 $:
$Date:: 2022-06-28 14:44:22#$:

CPU:               Freescale Kinetis P/N MK60FN1M0VLQ15 (144-Pin), REVID ?
Compiler:          IAR ANSI C/C++ Compiler for ARM 6.50
*******************************************************************************/
/***************************************************************************//**
\file      system.h
\brief     Main application for RF20000 RF Ablation Generator.
\details   This file contain main(). The background and the state machine is
implemented in this file. S
*******************************************************************************/

#include "MK26F18.h"
#include "system.h"
#include "common.h"
#include <stdlib.h>
#include "state_machine.h"
#include "psu.h"
#include "init.h"
#include "wand.h"
#include "notifications.h"
#include "switches.h"
#include "footpedal.h"
#include "audio.h"
#include "led.h"
#include "gui.h"
#include "sensors.h"
#include "adc.h"
#include "can.h"
#include "post.h"
#include "wdog.h"
#include "can_debug.h"
#include "systick.h"
#include "lpt.h"
#include "buck.h"
#include "rf.h"
#include "sensors.h"
#include "ftfe.h"
#include "cpu.h"
#include "zigbee.h"
#include "profiles.h"
#include "sw_manager.h"
#include "legacy_wand.h"
#include "bdm_ww_main.h"

/*******************************************************************************
 * Global structure for all therapy settings 
 *
 * Note: Use of volatile here is to help protect structures against asynchronous
 * access since they are global.
 ******************************************************************************/
#pragma data_alignment = 32
GEN_SETTINGS current_therapy_settings;
SMART_WAND_PARAMETERS smart_wand_params;
COMMON_WAND_PARAMS smart_wand_common_params;
COMMON_WAND_PARAMS legacy_wand_common_params;


/* append these values to end of main app flash */

/* date of compliation "Mmm dd yyyy" in rom*/
//__root const char compile_date[11] @ 0x10014 = __DATE__;
/* time of compilation "hh:mm:ss" in rom*/
//__root const char compile_time[8] @ 0x10020 = __TIME__;
/* mfg time in rom */
//__root const uint8_t mfg_time[MFG_TIME_NUM_CHARS] @ __MFG_DATE_TIME__ = {'E','F','G','H'};
//__root const uint8_t mfg_time[MFG_TIME_NUM_CHARS] @ 0x7FFFC;// = {'E','F','G','H'};
/* s/n in rom */
//__root const uint8_t serial_number[MFG_SERIAL_NUM_CHARS] = {'A','B','C','D'};
//__root const uint8_t serial_number[MFG_SERIAL_NUM_CHARS] @ 0x7FFF8;// = {'A','B','C','D'};

__root uint8_t serial_number[MFG_SERIAL_NUM_CHARS], 
               bcd_serial_number[MFG_SERIAL_NUM_CHARS];
__root uint8_t mfg_date_time[MFG_TIME_NUM_CHARS];

//uint8_t do_nothing();

state current_state;
event_table evt_tbl;
extern legacy_wand_params legacy_wand_params_obj;
state_object state_matrix[MAXIMUM_STATES][MAX_EVENT] = 
{
/*******************************************************************************
 *                             POWERUP State                                   *
 ******************************************************************************/
  { //Current_state, next_state, entry_func, action_on_event, exit_func
/* 1  */ {POWERUP_STATE, 0, 0, 0},
/* 2  */ {POWERUP_STATE, 0, 0, 0},
/* 3  */ {POWERUP_STATE, 0, 0, 0},
/* 4  */ {POWERUP_STATE, 0, 0, 0},
/* 5  */ {POWERUP_STATE, 0, 0, 0},
/* 6  */ {POWERUP_STATE, 0, 0, 0},
/* 7  */ {POWERUP_STATE, 0, 0, 0},
/* 8  */ {POWERUP_STATE, 0, 0, 0},
/* 9  */ {POWERUP_STATE, 0, 0, 0},
/* 10 */ {POWERUP_STATE, 0, 0, 0},
/* 11 */ {POWERUP_STATE, 0, 0, 0},
/* 12 */ {POWERUP_STATE, 0, 0, 0},
/* 13 */ {POWERUP_STATE, 0, 0, 0},
/* 14 */ {POWERUP_STATE, 0, 0, 0},
/* 15 */ {POWERUP_STATE, 0, 0, 0},
/* 16 */ {POWERUP_STATE, 0, 0, 0},
/* 17 */ {POWERUP_STATE, 0, 0, 0},
/* 18 */ {POWERUP_STATE, 0, power_board_on, sys_init},
/* 19 */ {POWERUP_STATE, 0, poll_pwr_button, 0},
/* 20 */ {POWERUP_STATE, 0, 0, 0},
/* 21 */ {POWERUP_STATE, 0, 0, 0},
/* 22 */ {POWERUP_STATE, 0, 0, 0},
/* 23 */ {POWERUP_STATE, 0, 0, 0},
/* 24 */ {POWERUP_STATE, 0, 0, 0},
/* 25 */ {POWERUP_STATE, 0, 0, 0},
/* 26 */ {POWERUP_STATE, 0, 0, 0},
/* 27 */ {POWERUP_STATE, 0, 0, 0},
/* 28 */ {POWERUP_STATE, 0, 0, 0},
/* 29 */ {POWERUP_STATE, 0, 0, 0},
/* 30 */ {POWERUP_STATE, 0, 0, 0},
/* 31 */ {POWERUP_STATE, 0, 0, 0},
/* 32 */ {POWERUP_STATE, 0, poll_adc_data, 0},
/* 33 */ {POWERUP_STATE, 0, 0, 0},
/* 34 */ {POWERUP_STATE, 0, 0, 0},
/* 35 */ {POWERUP_STATE, 0, 0, 0},
/* 36 */ {POWERUP_STATE, 0, 0, 0},
/* 37 */ {POWERUP_STATE, 0, 0, 0},
/* 38 */ {POWERUP_STATE, 0, 0, 0},
/* 39 */ {POWERUP_STATE, 0, 0, 0},
/* 40 */ {POWERUP_STATE, 0, 0, 0},
/* 41 */ {POWERUP_STATE, 0, 0, 0},
/* 42 */ {POWERUP_STATE, 0, 0, 0},
/* 43 */ {POWERUP_STATE, 0, 0, 0},
/* 44 */ {POWERUP_STATE, 0, 0, 0},
/* 45 */ {POWERUP_STATE, 0, 0, 0}, 
/* 46 */ {POWERUP_STATE, 0, 0, 0},
/* 47 */ {POWERUP_STATE, 0, 0, 0},
/* 48 */ {POWERUP_STATE, 0, 0, 0}, 
/* 49 */ {POWERUP_STATE, 0, 0, 0},
/* 50 */ {POWERUP_STATE, 0, 0, 0},
/* 51 */ {POWERUP_STATE, 0, 0, 0},
/* 52 */ {POWERUP_STATE, 0, 0, 0},
/* 53 */ {POWERUP_STATE, 0, adc3_coco, 0},
/* 54 */ {POWERUP_STATE, 0, 0, 0},
/* 55 */ {POWERUP_STATE, 0, 0, 0},
/* 56 */ {POWERUP_STATE, 0, 0, 0},
/* 57 */ {POWERUP_STATE, 0, crc_fault, 0},
/* 58 */ {POWERUP_STATE, 0, 0, 0},
/* 59 */ {POWERUP_STATE, 0, 0, 0},
/* 60 */ {POWERUP_STATE, 0, 0, 0},
/* 61 */ {POWERUP_STATE, 0, 0, 0},
/* 62 */ {POWERUP_STATE, 0, 0, 0},
/* 63 */ {POWERUP_STATE, 0, 0, 0},
/* 64 */ {POWERUP_STATE, 0, 0, 0},
/* 65 */ {POWERUP_STATE, 0, 0, 0},
/* 66 */ {POWERUP_STATE, 0, 0, 0},
/* 67 */ {POWERUP_STATE, 0, 0, 0},
/* 68 */ {POWERUP_STATE, 0, 0, 0},
/* 69 */ {POWERUP_STATE, 0, 0, 0},
/* 70 */ {POWERUP_STATE, 0, 0, 0},
/* 71 */ {POWERUP_STATE, 0, lpt_init, init_manager},
/* 72 */ {POWERUP_STATE, 0, pump_uart_init, init_manager},
/* 73 */ {POWERUP_STATE, 0, dma_mux_init, init_manager},
/* 74 */ {POWERUP_STATE, 0, systick_init, init_manager},
/* 75 */ {POWERUP_STATE, 0, audio_vol_ctrl_init, init_manager},
/* 76 */ {POWERUP_STATE, 0, audio_pwm_init, init_manager},
/* 77 */ {POWERUP_STATE, 0, foot_pedal_init, init_manager},
/* 78 */ {POWERUP_STATE, 0, buck_init, init_manager},
/* 79 */ {POWERUP_STATE, 0, smartwand_pwm_init, init_manager},
/* 80 */ {POWERUP_STATE, 0, adc_init, init_manager},
/* 81 */ {POWERUP_STATE, 0, flexcan_init, init_manager},
/* 82 */ {POWERUP_STATE, 0, smartwand_uart_init, init_manager},
/* 83 */ {POWERUP_STATE, 0, door_sensor_init, init_manager},
/* 84 */ {POWERUP_STATE, 0, tube_sensors_init, init_manager},
/* 85 */ {POWERUP_STATE, 0, led_init, init_manager},
/* 86 */ {POWERUP_STATE, 0, legacy_wand_init, init_manager},
/* 87 */ {POWERUP_STATE, 0, zigbee_init, init_manager},
/* 88 */ {POWERUP_STATE, 0, esdhc_init, init_manager},
/* 89 */ {POWERUP_STATE, 0, audio_amp_init, init_manager},
/* 90 */ {STARTUP_STATE, 0, init_manager, 0},
/* 91 */ {POWERUP_STATE, 0, wdog_refresh, 0},
/* 92 */ {POWERUP_STATE, 0, 0, 0},
/* 93 */ {POWERUP_STATE, 0, 0, 0},
/* 94 */ {POWERUP_STATE, 0, 0, 0},
/* 95 */ {POWERUP_STATE, 0, 0, 0},
/* 96 */ {POWERUP_STATE, 0, 0, 0},
/* 97 */ {POWERUP_STATE, 0, 0, 0},
/* 98 */ {POWERUP_STATE, 0, 0, 0},
/* 99 */ {POWERUP_STATE, 0, 0, 0},
/* 100*/ {POWERUP_STATE, 0, 0, 0},
/* 101*/ {POWERUP_STATE, 0, 0, 0},
/* 102*/ {POWERUP_STATE, 0, 0, 0},
/* 103*/ {POWERUP_STATE, 0, 0, 0},
/* 104*/ {POWERUP_STATE, 0, reset_pulse_cnt, 0},
/* 105*/ {POWERUP_STATE, 0, 0, 0},
/* 106*/ {POWERUP_STATE, 0, 0, 0},
/* 107*/ {POWERUP_STATE, 0, 0, 0},
/* 108*/ {POWERUP_STATE, 0, 0, 0},
/* 109*/ {POWERUP_STATE, 0, 0, 0},
/* 110*/ {POWERUP_STATE, 0, 0, 0},
/* 111*/ {POWERUP_STATE, 0, 0, 0},
/* 112*/ {POWERUP_STATE, 0, 0, 0},
/* 113*/ {POWERUP_STATE, 0, 0, 0},
/* 114*/ {POWERUP_STATE, 0, 0, 0},
/* 115*/ {POWERUP_STATE, 0, 0, 0},
/* 116*/ {POWERUP_STATE, 0, sd_card_init_callback, init_manager},
/* 117*/ {POWERUP_STATE, 0, 0, 0},
/* 118*/ {POWERUP_STATE, 0, 0, 0},
/* 119*/ {POWERUP_STATE, 0, 0, 0},
/* 120*/ {POWERUP_STATE, 0, 0, 0},
/* 121*/ {POWERUP_STATE, 0, 0, 0},
/* 122*/ {POWERUP_STATE, 0, 0, 0},
/* 123*/ {POWERUP_STATE, 0, 0, 0},
/* 124*/ {POWERUP_STATE, 0, 0, 0},
/* 125*/ {POWERUP_STATE, 0, 0, 0},
/* 126*/ {POWERUP_STATE, 0, 0, 0},
/* 127*/ {POWERUP_STATE, 0, 0, 0},
/* 128*/ {POWERUP_STATE, 0, 0, 0},
/* 129*/ {POWERUP_STATE, 0, 0, 0},
/* 130*/ {POWERUP_STATE, 0, 0, 0},
/* 131*/ {POWERUP_STATE, 0, 0, 0},
/* 132*/ {POWERUP_STATE, 0, 0, 0},
/* 133*/ {POWERUP_STATE, 0, 0, 0},
/* 134*/ {POWERUP_STATE, 0, 0, 0},
/* 135*/ {POWERUP_STATE, 0, 0, 0},
/* 136*/ {POWERUP_STATE, 0, 0, 0},
/* 137*/ {POWERUP_STATE, 0, 0, 0},
/* 139*/ {POWERUP_STATE, 0, 0, 0},
/* 140*/ {POWERUP_STATE, 0, 0, 0},
/* 141*/ {POWERUP_STATE, 0, 0, 0},
/* 142*/ {POWERUP_STATE, 0, 0, 0},
/* 143*/ {POWERUP_STATE, 0, 0, 0},
/* 144*/ {POWERUP_STATE, 0, 0, 0},
/* 145*/ {POWERUP_STATE, 0, 0, 0},
/* 146*/ {POWERUP_STATE, 0, 0, 0},
/* 147*/ {POWERUP_STATE, 0, 0, 0},
/* 148*/ {POWERUP_STATE, 0, 0, 0},
/* 149*/ {POWERUP_STATE, 0, 0, 0},
/* 150*/ {POWERUP_STATE, 0, bdm_poll_usb, 0},
/* 151*/ {POWERUP_STATE, 0, 0, 0},
  },
/*******************************************************************************
 *                             STARTUP State                                   *
 ******************************************************************************/
  { //Current_state, next_state, entry_func, action_on_event, exit_func
/* 1  */ {STARTUP_STATE, post_init, 0, 0},
/* 2  */ {STARTUP_STATE, 0, 0, 0},
/* 3  */ {STARTUP_STATE, 0, 0, 0},
/* 4  */ {STARTUP_STATE, 0, 0, 0},
/* 5  */ {STARTUP_STATE, 0, 0, 0},
/* 6  */ {STARTUP_STATE, 0, 0, 0},
/* 7  */ {STARTUP_STATE, 0, wand_unlock, cancel_sw_update},
/* 8  */ {STARTUP_STATE, 0, 0, 0},
/* 9  */ {STARTUP_STATE, 0, 0, 0},
/* 10 */ {STARTUP_STATE, 0, 0, 0},
/* 11 */ {STARTUP_STATE, 0, check_fs_stuck, 0},
/* 12 */ {STARTUP_STATE, 0, set_volume, 0},
/* 13 */ {STARTUP_STATE, 0, 0, 0},
/* 14 */ {STARTUP_STATE, 0, 0, 0},
/* 15 */ {STARTUP_STATE, 0, 0, 0},
/* 16 */ {STARTUP_STATE, 0, 0, 0},
/* 17 */ {STARTUP_STATE, 0, 0, 0},
/* 18 */ {STARTUP_STATE, 0, 0, 0},
/* 19 */ {SHUTDOWN_STATE, 0, poll_pwr_button, 0},
/* 20 */ {STARTUP_STATE, 0, 0, 0},
/* 21 */ {STARTUP_STATE, 0, 0, 0},
/* 22 */ {STARTUP_STATE, 0, 0, 0},
/* 23 */ {STARTUP_STATE, 0, startup_leds, 0},
/* 24 */ {STARTUP_STATE, 0, 0, 0},
/* 25 */ {STARTUP_STATE, 0, 0, 0},
/* 26 */ {STARTUP_STATE, 0, 0, 0},
/* 27 */ {STARTUP_STATE, 0, poll_pump_sensors, 0},
/* 28 */ {STARTUP_STATE, 0, load_screen01, 0},
/* 29 */ {STARTUP_STATE, 0, 0, 0},
/* 30 */ {STARTUP_STATE, 0, irms_overcurrent, 0},
/* 31 */ {STARTUP_STATE, 0, 0, 0},
/* 32 */ {STARTUP_STATE, 0, poll_adc_data, 0},
/* 33 */ {STARTUP_STATE, 0, read_flexcan, 0},
/* 34 */ {STARTUP_STATE, 0, 0, 0},
/* 35 */ {STARTUP_STATE, 0, flexCAN_write_fast_msgs, 0},
/* 36 */ {STARTUP_STATE, 0, 0, 0},
/* 37 */ {STARTUP_STATE, 0, 0, 0},
/* 38 */ {STARTUP_STATE, 0, 0, 0},
/* 39 */ {STARTUP_STATE, 0, pump_cmd_ack, pump_packetizer},
/* 40 */ {STARTUP_STATE, 0, pump_reset, 0},
/* 41 */ {STARTUP_STATE, 0, pump_packetizer, 0},
/* 42 */ {STARTUP_STATE, 0, drive_status, 0},
/* 43 */ {STARTUP_STATE, 0, pump_cmd_nack, 0},
/* 44 */ {STARTUP_STATE, 0, can_wdog_rx, 0},
/* 45 */ {STARTUP_STATE, 0, 0, 0}, 
/* 46 */ {IDLE_STATE, 0, post, post_exit},
/* 47 */ {FAULT_STATE, 0, can_timeout, post_exit},
/* 48 */ {STARTUP_STATE, 0, 0, 0},
/* 49 */ {STARTUP_STATE, 0, 0, 0}, 
/* 50 */ {STARTUP_STATE, 0, 0, 0},
/* 51 */ {STARTUP_STATE, 0, 0, 0},
/* 52 */ {STARTUP_STATE, 0, 0, 0},
/* 53 */ {STARTUP_STATE, 0, adc3_coco, 0},
/* 54 */ {STARTUP_STATE, 0, internal_temp_error, 0},
/* 55 */ {STARTUP_STATE, 0, clear_internal_temp_error, 0},
/* 56 */ {FAULT_STATE, 0, adc_boundary_fault, post_exit},
/* 57 */ {FAULT_STATE, 0, crc_fault, post_exit},
/* 58 */ {STARTUP_STATE, 0, 0, 0},
/* 59 */ {FAULT_STATE, 0, vmod_fault, post_exit},
/* 60 */ {FAULT_STATE, 0,  internal_temp_fault, post_exit},
/* 61 */ {STARTUP_STATE, 0, 0, 0},
/* 62 */ {STARTUP_STATE, 0, 0, 0},
/* 63 */ {STARTUP_STATE, 0, 0, 0},
/* 64 */ {STARTUP_STATE, 0, 0, 0},
/* 65 */ {FAULT_STATE, 0, wdog_fault, post_exit},
/* 66 */ {FAULT_STATE, 0, 0, 0},
/* 67 */ {FAULT_STATE, 0, date_time_fault, 0},
/* 68 */ {STARTUP_STATE, 0, drive_power_mode, 0},
/* 69 */ {STARTUP_STATE, 0, probe_test_complete, 0},
/* 70 */ {STARTUP_STATE, 0, 0, 0},
/* 71 */ {STARTUP_STATE, 0, 0, 0},
/* 72 */ {STARTUP_STATE, 0, 0, 0},
/* 73 */ {STARTUP_STATE, 0, 0, 0},
/* 74 */ {STARTUP_STATE, 0, 0, 0},
/* 75 */ {STARTUP_STATE, 0, 0, 0},
/* 76 */ {STARTUP_STATE, 0, 0, 0},
/* 77 */ {STARTUP_STATE, 0, 0, 0},
/* 78 */ {STARTUP_STATE, 0, 0, 0},
/* 79 */ {STARTUP_STATE, 0, 0, 0},
/* 80 */ {STARTUP_STATE, 0, 0, 0},
/* 81 */ {STARTUP_STATE, 0, 0, 0},
/* 82 */ {STARTUP_STATE, 0, 0, 0},
/* 83 */ {STARTUP_STATE, 0, 0, 0},
/* 84 */ {STARTUP_STATE, 0, 0, 0},
/* 85 */ {STARTUP_STATE, 0, 0, 0},
/* 86 */ {STARTUP_STATE, 0, 0, 0},
/* 87 */ {STARTUP_STATE, 0, 0, 0},
/* 88 */ {STARTUP_STATE, 0, 0, 0},
/* 89 */ {STARTUP_STATE, 0, 0, 0},
/* 90 */ {STARTUP_STATE, 0, 0, 0},
/* 91 */ {STARTUP_STATE, 0, wdog_refresh, 0},
/* 92 */ {STARTUP_STATE, 0, 0, 0},
/* 93 */ {STARTUP_STATE, 0, 0, 0},
/* 94 */ {STARTUP_STATE, 0, 0, 0},
/* 95 */ {STARTUP_STATE, 0, 0, 0},
/* 96 */ {STARTUP_STATE, 0, 0, 0},
/* 97 */ {STARTUP_STATE, 0, 0, 0},
/* 98 */ {FAULT_STATE, 0, fp_switch_stuck_fault, post_exit},
/* 99 */ {STARTUP_STATE, 0, 0, 0},
/* 100*/ {STARTUP_STATE, 0, 0, 0},
/* 101*/ {STARTUP_STATE, 0, get_mfg_date, 0},
/* 102*/ {STARTUP_STATE, 0, get_serial_num, 0},
/* 103*/ {STARTUP_STATE, 0, 0, 0},
/* 104*/ {STARTUP_STATE, 0, 0, 0},
/* 105*/ {STARTUP_STATE, 0, 0, 0},
/* 106*/ {STARTUP_STATE, 0, 0, 0},
/* 107*/ {STARTUP_STATE, 0, buck_inactive_shutdown, 0},
/* 108*/ {STARTUP_STATE, 0, 0, 0},
/* 109*/ {STARTUP_STATE, 0, flexCAN_write_slow_msgs, 0},
/* 110*/ {STARTUP_STATE, 0, 0, 0},
/* 111*/ {STARTUP_STATE, 0, 0, 0},
/* 112*/ {STARTUP_STATE, 0, 0, 0},
/* 113*/ {STARTUP_STATE, 0, 0, 0},
/* 114*/ {STARTUP_STATE, 0, 0, 0},
/* 115*/ {STARTUP_STATE, 0, 0, 0},
/* 116*/ {STARTUP_STATE, 0, sd_card_rw, 0},
/* 117*/ {STARTUP_STATE, 0, 0, 0},
/* 118*/ {STARTUP_STATE, 0, 0, 0},
/* 119*/ {STARTUP_STATE, 0, check_18p_fs_stuck, 0},
/* 120*/ {STARTUP_STATE, 0, 0, 0},
/* 121*/ {STARTUP_STATE, 0, 0, 0},
/* 122*/ {STARTUP_STATE, 0, 0, 0},
/* 123*/ {STARTUP_STATE, 0, 0, 0},
/* 124*/ {STARTUP_STATE, 0, 0, 0},
/* 125*/ {STARTUP_STATE, 0, 0, 0},
/* 126*/ {STARTUP_STATE, 0, 0, 0},
/* 127*/ {STARTUP_STATE, 0, 0, 0},
/* 128*/ {STARTUP_STATE, 0, 0, 0},
/* 129*/ {STARTUP_STATE, 0, 0, 0},
/* 130*/ {STARTUP_STATE, 0, 0, 0},
/* 131*/ {STARTUP_STATE, 0, 0, 0},
/* 132*/ {FAULT_STATE, 0, lw_wand_switch_stuck_fault, post_exit},
/* 133*/ {STARTUP_STATE, 0, 0, 0},
/* 134*/ {STARTUP_STATE, 0, 0, 0},
/* 135*/ {STARTUP_STATE, 0, 0, 0},
/* 136*/ {STARTUP_STATE, 0, 0, 0},
/* 137*/ {STARTUP_STATE, 0, vmod2_test, 0},
/* 138*/ {STARTUP_STATE, 0, log2sdhc, 0},
/* 139*/ {STARTUP_STATE, 0, 0, 0},
/* 140*/ {STARTUP_STATE, 0, 0, 0},
/* 141*/ {STARTUP_STATE, 0, vmod_interp, 0},
/* 142*/ {FAULT_STATE, 0, gen_com_fault, 0},
/* 143*/ {STARTUP_STATE, 0, 0, 0},
/* 144*/ {STARTUP_STATE, 0, vmod1_test, 0},
/* 145*/ {FAULT_STATE, 0, ui_fault, 0},
/* 146*/ {STARTUP_STATE, 0, pump_cmd_eack, 0},
/* 147*/ {STARTUP_STATE, 0, pump_startup_delay, 0},
/* 148*/ {STARTUP_STATE, 0, 0, 0},
/* 149*/ {STARTUP_STATE, 0, 0, 0},
/* 150*/ {STARTUP_STATE, 0, bdm_poll_usb, 0},
/* 151*/ {STARTUP_STATE, 0, 0, 0},
  },
/*******************************************************************************
 *                             IDLE State                                      *
 ******************************************************************************/
{ //Current_state, next_state, entry_func, action_on_event, exit_func
/* 1  */ {IDLE_STATE, IDLE_state_entry, 0, 0},
/* 2  */ {IDLE_STATE, 0, wand_download_parm_pg_1, 0},
/* 3  */ {IDLE_STATE, 0, wand_download_parm_pg_2, 0},
/* 4  */ {IDLE_STATE, 0, wand_download_parm_pg_3, 0},
/* 5  */ {IDLE_STATE, 0, wand_download_parm_pg_4, 0},
/* 6  */ {IDLE_STATE, 0, wand_validate, 0},
/* 7  */ {IDLE_STATE, 0, wand_unlock, cancel_sw_update},
/* 8  */ {IDLE_STATE, 0, wand_download_parm_pg_0, 0},
/* 9  */ {IDLE_STATE, 0, 0, 0},
/* 10 */ {IDLE_STATE, 0, 0, 0},
/* 11 */ {IDLE_STATE, 0, poll_footpedal, 0},
/* 12 */ {IDLE_STATE, 0, set_volume, 0},
/* 13 */ {IDLE_STATE, 0, reset_alarm_audio, 0},
/* 14 */ {IDLE_STATE, 0, pump_speed_ctrl, 0},
/* 15 */ {IDLE_STATE, 0, 0, 0},
/* 16 */ {IDLE_STATE, 0, 0, 0},
/* 17 */ {IDLE_STATE, 0, update_gui, 0},
/* 18 */ {IDLE_STATE, 0, 0, 0},
/* 19 */ {SHUTDOWN_STATE, 0, poll_pwr_button, 0},
/* 20 */ {IDLE_STATE, 0, 0, 0},
/* 21 */ {IDLE_STATE, 0, 0, 0},
/* 22 */ {IDLE_STATE, 0, 0, 0},
/* 23 */ {IDLE_STATE, 0, update_leds, 0},
/* 24 */ {IDLE_STATE, 0, wand_lock, 0},
/* 25 */ {IDLE_STATE, 0, wand_tx, 0},
/* 26 */ {IDLE_STATE, 0, smartwand_timeout, 0},
/* 27 */ {IDLE_STATE, 0, poll_pump_sensors, 0},
/* 28 */ {IDLE_STATE, 0, update_screen, 0},
/* 29 */ {IDLE_STATE, 0, 0, 0},
/* 30 */ {IDLE_STATE, 0, irms_overcurrent, 0},
/* 31 */ {IDLE_STATE, 0, 0, 0},
/* 32 */ {IDLE_STATE, 0, poll_adc_data, 0},
/* 33 */ {IDLE_STATE, 0, read_flexcan, 0},
/* 34 */ {IDLE_STATE, 0, audible_click, 0},
/* 35 */ {IDLE_STATE, 0, flexCAN_write_fast_msgs, 0},
/* 36 */ {IDLE_STATE, 0, 0, 0},
/* 37 */ {IDLE_STATE, 0, 0, 0},
/* 38 */ {IDLE_STATE, 0, 0, 0},
/* 39 */ {IDLE_STATE, 0, pump_cmd_ack, pump_packetizer},
/* 40 */ {IDLE_STATE, 0, pump_reset, 0},
/* 41 */ {IDLE_STATE, 0, pump_packetizer, 0},
/* 42 */ {IDLE_STATE, 0, drive_status, 0},
/* 43 */ {IDLE_STATE, 0, pump_cmd_nack, 0},
/* 44 */ {IDLE_STATE, 0, can_wdog_rx, 0},
/* 45 */ {IDLE_STATE, 0, 0, 0}, 
/* 46 */ {IDLE_STATE, 0, 0, 0}, 
/* 47 */ {FAULT_STATE, 0, gui_com_fault, 0},
/* 48 */ {IDLE_STATE, 0, 0, 0},
/* 49 */ {IDLE_STATE, 0, 0, 0},
/* 50 */ {IDLE_STATE, 0, reset_error, 0},
/* 51 */ {IDLE_STATE, 0, suction_tube_error, 0},
/* 52 */ {IDLE_STATE, 0, 0, 0},
/* 53 */ {IDLE_STATE, 0, adc3_coco, 0},
/* 54 */ {IDLE_STATE, 0, internal_temp_error, 0},
/* 55 */ {IDLE_STATE, 0, clear_internal_temp_error, 0},
/* 56 */ {FAULT_STATE, 0, adc_boundary_fault, 0},
/* 57 */ {IDLE_STATE, 0, 0, 0},
/* 58 */ {FAULT_STATE, 0, pump_fault, 0},
/* 59 */ {FAULT_STATE, 0, vmod_fault, 0},
/* 60 */ {FAULT_STATE, 0,  internal_temp_fault, 0},
/* 61 */ {IDLE_STATE, 0, irms2_adc_result, 0},
/* 62 */ {IDLE_STATE, 0, wand_static_read, 0},
/* 63 */ {IDLE_STATE, 0, wand_static_write, 0},
/* 64 */ {USER_INPUT_STATE, 0, wand_circle_log_read, switch_ablate_parameters},
/* 65 */ {IDLE_STATE, 0, 0, 0},
/* 66 */ {FAULT_STATE, 0, serial_num_fault, 0},
/* 67 */ {FAULT_STATE, 0, date_time_fault, 0},
/* 68 */ {IDLE_STATE, 0, 0, 0},
/* 69 */ {IDLE_STATE, 0, 0, 0},
/* 70 */ {IDLE_STATE, 0, 0, 0},
/* 71 */ {IDLE_STATE, 0, 0, 0},
/* 72 */ {IDLE_STATE, 0, 0, 0},
/* 73 */ {IDLE_STATE, 0, 0, 0},
/* 74 */ {IDLE_STATE, 0, 0, 0},
/* 75 */ {IDLE_STATE, 0, 0, 0},
/* 76 */ {IDLE_STATE, 0, 0, 0},
/* 77 */ {IDLE_STATE, 0, 0, 0},
/* 78 */ {IDLE_STATE, 0, 0, 0},
/* 79 */ {IDLE_STATE, 0, 0, 0},
/* 80 */ {IDLE_STATE, 0, 0, 0},
/* 81 */ {IDLE_STATE, 0, 0, 0},
/* 82 */ {IDLE_STATE, 0, 0, 0},
/* 83 */ {IDLE_STATE, 0, 0, 0},
/* 84 */ {IDLE_STATE, 0, 0, 0},
/* 85 */ {IDLE_STATE, 0, 0, 0},
/* 86 */ {IDLE_STATE, 0, 0, 0},
/* 87 */ {IDLE_STATE, 0, 0, 0},
/* 88 */ {IDLE_STATE, 0, 0, 0},
/* 89 */ {IDLE_STATE, 0, 0, 0},
/* 90 */ {IDLE_STATE, 0, 0, 0},
/* 91 */ {IDLE_STATE, 0, wdog_refresh, 0},
/* 92 */ {IDLE_STATE, 0, 0, 0},
/* 93 */ {FAULT_STATE, 0, wand_switch_stuck_fault, 0},
/* 94 */ {IDLE_STATE, 0, wand_expired_error, 0},
/* 95 */ {IDLE_STATE, 0, wand_use_limit_error, 0},
/* 96 */ {IDLE_STATE, 0, 0, 0},
/* 97 */ {IDLE_STATE, 0, wand_id_error, 0},
/* 98 */ {IDLE_STATE, 0, 0, 0},
/* 99 */ {IDLE_STATE, 0, 0, 0},
/* 100*/ {IDLE_STATE, 0, 0, 0},
/* 101*/ {IDLE_STATE, 0, 0, 0},
/* 102*/ {IDLE_STATE, 0, 0, 0},
#ifdef DEBUG_CAN
/* 103*/ {IDLE_STATE, 0, flexCAN_write_wanddebug, 0},
#else
/* 103*/ {IDLE_STATE, 0, 0, 0},
#endif
/* 104*/ {IDLE_STATE, 0, reset_pulse_cnt, 0},
/* 105*/ {IDLE_STATE, 0, 0, 0},
/* 106*/ {IDLE_STATE, 0, 0, 0},
/* 107*/ {IDLE_STATE, 0, buck_inactive_shutdown, 0},
/* 108*/ {IDLE_STATE, 0, wand_circle_write, 0},
/* 109*/ {IDLE_STATE, 0, flexCAN_write_slow_msgs, 0},
/* 110*/ {IDLE_STATE, 0, request_statusbytes, 0},
#ifdef DEBUG_CAN
/* 111*/ {IDLE_STATE, 0, flexCAN_write_wireless, 0},
#else
/* 111*/ {IDLE_STATE, 0, 0, 0},
#endif
/* 112*/ {IDLE_STATE, 0, wireless_handshake, 0},
/* 113*/ {IDLE_STATE, 0, 0, 0},
/* 114*/ {SW_UPDATE_STATE, 0, commence_uis_sw_update, 0},
/* 115*/ {IDLE_STATE, 0, 0, 0},
/* 116*/ {IDLE_STATE, 0, sd_card_rw, 0},
/* 117*/ {IDLE_STATE, 0, 0, 0},
/* 118*/ {IDLE_STATE, 0, 0, 0},
/* 119*/ {LW_UI_STATE, 0, legacy_wand_read_adc_values, legacy_wand_UI_state_entry},
/* 120*/ {IDLE_STATE, 0, 0, 0},
/* 121*/ {IDLE_STATE, 0, 0, 0},
/* 122*/ {IDLE_STATE, 0, 0, 0},
/* 123*/ {IDLE_STATE, 0, 0, 0},
/* 124*/ {IDLE_STATE, 0, 0, 0},
/* 125*/ {IDLE_STATE, 0, 0, 0},
/* 126*/ {IDLE_STATE, 0, 0, 0},
/* 127*/ {IDLE_STATE, 0, legacy_irms_adc_result, 0},
/* 128*/ {LW_UI_STATE, 0, switch_to_legacy_wand, legacy_wand_UI_state_entry},
/* 129*/ {IDLE_STATE, 0, 0, 0},
/* 130*/ {IDLE_STATE, 0, 0, 0},
/* 131*/ {FAULT_STATE, 0, legacy_wand_adc_fault, 0},
/* 132*/ {IDLE_STATE, 0, 0, 0},
/* 133*/ {IDLE_STATE, 0, lw_wand_expired_error, 0},
/* 134*/ {IDLE_STATE, 0, lw_wand_use_limit_error, 0},
/* 135*/ {IDLE_STATE, 0, 0, 0},
/* 136*/ {IDLE_STATE, 0, cancel_sw_update, 0},
/* 137*/ {IDLE_STATE, 0, 0, 0},
/* 138*/ {IDLE_STATE, 0, log2sdhc, 0},
/* 139*/ {IDLE_STATE, 0, lw_id_error, 0},
/* 140*/ {IDLE_STATE, 0, lw_incompatible_error, 0},
/* 141*/ {IDLE_STATE, 0, 0, 0},
/* 142*/ {FAULT_STATE, 0, gen_com_fault, 0},
/* 143*/ {IDLE_STATE, 0, two_wand_disconnected_error, 0},
/* 144*/ {IDLE_STATE, 0, 0, 0},
/* 145*/ {FAULT_STATE, 0, ui_fault, 0},
/* 146*/ {IDLE_STATE, 0, pump_cmd_eack, 0},
/* 147*/ {IDLE_STATE, 0, cbtmr_isr, 0},
/* 148*/ {IDLE_STATE, 0, 0, 0},
/* 149*/ {IDLE_STATE, 0, 0, 0},
/* 150*/ {IDLE_STATE, 0, bdm_poll_usb, 0},
/* 151*/ {IDLE_STATE, 0, 0, 0},
  },
  
/*******************************************************************************
 *                           USER INPUT State                                  *
 ******************************************************************************/
  { //Current_state, next_state, entry_func, action_on_event, exit_func
/* 1  */ {USER_INPUT_STATE, 0, 0, 0},
/* 2  */ {USER_INPUT_STATE, 0, 0, 0},
/* 3  */ {USER_INPUT_STATE, 0, 0, 0},
/* 4  */ {USER_INPUT_STATE, 0, 0, 0},
/* 5  */ {USER_INPUT_STATE, 0, 0, 0},
/* 6  */ {USER_INPUT_STATE, 0, 0, 0},
/* 7  */ {IDLE_STATE, 0, wand_unlock, 0},
/* 8  */ {USER_INPUT_STATE, 0, 0, 0},
/* 9  */ {USER_INPUT_STATE, 0, wand_periodic_packet_parse, 0},
/* 10 */ {USER_INPUT_STATE, 0, change_mode, play_change_mode_audio},
/* 11 */ {USER_INPUT_STATE, 0, poll_footpedal, 0},
/* 12 */ {USER_INPUT_STATE, 0, set_volume, 0},
/* 13 */ {USER_INPUT_STATE, 0, reset_alarm_audio, 0},
/* 14 */ {USER_INPUT_STATE, 0, pump_speed_ctrl, 0},
/* 15 */ {THERAPY_STATE, 0, therapy_on, 0},
/* 16 */ {USER_INPUT_STATE, 0, 0, 0},
/* 17 */ {USER_INPUT_STATE, 0, update_gui, 0},
/* 18 */ {USER_INPUT_STATE, 0, 0, 0},
/* 19 */ {SHUTDOWN_STATE, 0, poll_pwr_button, 0},
/* 20 */ {USER_INPUT_STATE, 0, 0, 0},
/* 21 */ {FAULT_STATE, 0, 0, 0},
/* 22 */ {USER_INPUT_STATE, 0, 0, 0},
/* 23 */ {USER_INPUT_STATE, 0, update_leds, 0},
/* 24 */ {IDLE_STATE, 0, wand_lock, 0},
/* 25 */ {USER_INPUT_STATE, 0, wand_tx, 0},
/* 26 */ {IDLE_STATE, 0, smartwand_timeout, 0},
/* 27 */ {USER_INPUT_STATE, 0, poll_pump_sensors, 0},
/* 28 */ {USER_INPUT_STATE, 0, update_screen, 0},
/* 29 */ {USER_INPUT_STATE, 0, 0, 0},
/* 30 */ {USER_INPUT_STATE, 0, irms_overcurrent, 0},
/* 31 */ {USER_INPUT_STATE, 0, pump_inactivity_monitor, 0},
/* 32 */ {USER_INPUT_STATE, 0, poll_adc_data, 0},
/* 33 */ {USER_INPUT_STATE, 0, read_flexcan, 0},
/* 34 */ {USER_INPUT_STATE, 0, audible_click, 0},
/* 35 */ {USER_INPUT_STATE, 0, flexCAN_write_fast_msgs, 0},
/* 36 */ {USER_INPUT_STATE, 0, 0, 0},
/* 37 */ {USER_INPUT_STATE, 0, 0, 0},
#ifdef DEBUG_CAN
/* 38 */ {USER_INPUT_STATE, 0, flexCAN_write_pumpdebug, 0},
#else
/* 38 */ {USER_INPUT_STATE, 0, 0, 0},
#endif
/* 39 */ {USER_INPUT_STATE, 0, pump_cmd_ack, pump_packetizer},
/* 40 */ {USER_INPUT_STATE, 0, pump_reset, 0},
/* 41 */ {USER_INPUT_STATE, 0, pump_packetizer, 0},
/* 42 */ {USER_INPUT_STATE, 0, drive_status, 0},
/* 43 */ {USER_INPUT_STATE, 0, pump_cmd_nack, 0},
/* 44 */ {USER_INPUT_STATE, 0, can_wdog_rx, 0},
/* 45 */ {USER_INPUT_STATE, 0, 0, 0}, 
/* 46 */ {USER_INPUT_STATE, 0, 0, 0}, 
/* 47 */ {FAULT_STATE, 0, gui_com_fault, 0},
/* 48 */ {USER_INPUT_STATE, 0, peak_hit_cntr, 0}, 
/* 49 */ {USER_INPUT_STATE, 0, 0, 0},
/* 50 */ {USER_INPUT_STATE, 0, reset_error, 0},
/* 51 */ {USER_INPUT_STATE, 0, suction_tube_error, 0},
/* 52 */ {USER_INPUT_STATE, 0, no_ambient_error, 0},
/* 53 */ {USER_INPUT_STATE, 0, adc3_coco, 0},
/* 54 */ {USER_INPUT_STATE, 0, internal_temp_error, 0},
/* 55 */ {USER_INPUT_STATE, 0, clear_internal_temp_error, 0},
/* 56 */ {FAULT_STATE, 0, adc_boundary_fault, 0},
/* 57 */ {USER_INPUT_STATE, 0, 0, 0},
/* 58 */ {FAULT_STATE, 0, pump_fault, 0},
/* 59 */ {FAULT_STATE, 0, vmod_fault, 0},
/* 60 */ {FAULT_STATE, 0,  internal_temp_fault, 0},
/* 61 */ {USER_INPUT_STATE, 0,  irms2_adc_result, 0},
/* 62 */ {USER_INPUT_STATE, 0, 0, 0},
/* 63 */ {USER_INPUT_STATE, 0, 0, 0},
/* 64 */ {USER_INPUT_STATE, 0, 0, 0},
/* 65 */ {USER_INPUT_STATE, 0, 0, 0},
/* 66 */ {USER_INPUT_STATE, 0, 0, 0},
/* 67 */ {FAULT_STATE, 0, date_time_fault, 0},
/* 68 */ {USER_INPUT_STATE, 0, 0, 0},
/* 69 */ {USER_INPUT_STATE, 0, 0, 0},
/* 70 */ {USER_INPUT_STATE, 0, 0, 0},
/* 71 */ {USER_INPUT_STATE, 0, 0, 0},
/* 72 */ {USER_INPUT_STATE, 0, 0, 0},
/* 73 */ {USER_INPUT_STATE, 0, 0, 0},
/* 74 */ {USER_INPUT_STATE, 0, 0, 0},
/* 75 */ {USER_INPUT_STATE, 0, 0, 0},
/* 76 */ {USER_INPUT_STATE, 0, 0, 0},
/* 77 */ {USER_INPUT_STATE, 0, 0, 0},
/* 78 */ {USER_INPUT_STATE, 0, 0, 0},
/* 79 */ {USER_INPUT_STATE, 0, 0, 0},
/* 80 */ {USER_INPUT_STATE, 0, 0, 0},
/* 81 */ {USER_INPUT_STATE, 0, 0, 0},
/* 82 */ {USER_INPUT_STATE, 0, 0, 0},
/* 83 */ {USER_INPUT_STATE, 0, 0, 0},
/* 84 */ {USER_INPUT_STATE, 0, 0, 0},
/* 85 */ {USER_INPUT_STATE, 0, 0, 0},
/* 86 */ {USER_INPUT_STATE, 0, 0, 0},
/* 87 */ {USER_INPUT_STATE, 0, 0, 0},
/* 88 */ {USER_INPUT_STATE, 0, 0, 0},
/* 89 */ {USER_INPUT_STATE, 0, 0, 0},
/* 90 */ {USER_INPUT_STATE, 0, 0, 0},
/* 91 */ {USER_INPUT_STATE, 0, wdog_refresh, 0},
/* 92 */ {USER_INPUT_STATE, 0, 0, 0},
/* 93 */ {FAULT_STATE, 0, wand_switch_stuck_fault, 0},
/* 94 */ {USER_INPUT_STATE, 0, 0, 0},
/* 95 */ {USER_INPUT_STATE, 0, wand_use_limit_error, 0},
/* 96 */ {USER_INPUT_STATE, 0, wand_use_limit_check, 0},
/* 97 */ {USER_INPUT_STATE, 0, 0, 0},
/* 98 */ {USER_INPUT_STATE, 0, 0, 0},
/* 99 */ {USER_INPUT_STATE, 0, 0, 0},
/* 100*/ {USER_INPUT_STATE, 0, 0, 0},
/* 101*/ {USER_INPUT_STATE, 0, 0, 0},
/* 102*/ {USER_INPUT_STATE, 0, 0, 0},
#ifdef DEBUG_CAN
/* 103*/ {USER_INPUT_STATE, 0, flexCAN_write_wanddebug, 0},
#else
/* 103*/ {USER_INPUT_STATE, 0, 0, 0},
#endif
/* 104*/ {USER_INPUT_STATE, 0, reset_pulse_cnt, 0},
/* 105*/ {USER_INPUT_STATE, 0, 0, 0},
/* 106*/ {USER_INPUT_STATE, 0, periodic_log_errors2wand, 0},
/* 107*/ {USER_INPUT_STATE, 0, buck_inactive_shutdown, 0},
/* 108*/ {USER_INPUT_STATE, 0, 0, 0},
/* 109*/ {USER_INPUT_STATE, 0, flexCAN_write_slow_msgs, 0},
/* 110*/ {USER_INPUT_STATE, 0, request_statusbytes, 0},
#ifdef DEBUG_CAN
/* 111*/ {USER_INPUT_STATE, 0, flexCAN_write_wireless, 0},
#else
/* 111*/ {USER_INPUT_STATE, 0, 0, 0},
#endif
/* 112*/ {USER_INPUT_STATE, 0, wireless_handshake, 0},
/* 113*/ {USER_INPUT_STATE, 0, 0, 0},
/* 114*/ {USER_INPUT_STATE, 0, 0, 0},
/* 115*/ {USER_INPUT_STATE, 0, 0, 0},
/* 116*/ {USER_INPUT_STATE, 0, sd_card_rw, 0},
/* 117*/ {USER_INPUT_STATE, 0, wand_wear_monitor, 0},
#ifdef DEBUG_CAN
/* 118*/ {USER_INPUT_STATE, 0, flexCAN_write_wand_wear_debug, 0},
#else
/* 118*/ {USER_INPUT_STATE, 0, 0, 0},
#endif
/* 119*/ {USER_INPUT_STATE, 0, legacy_wand_read_adc_values, 0},
/* 120*/ {LW_UI_STATE, 0, switch_to_legacy_wand, 0},
/* 121*/ {LW_UI_STATE, 0, switch_to_legacy_wand, 0},
/* 122*/ {LW_UI_STATE, 0, switch_to_legacy_wand, 0},
/* 123*/ {USER_INPUT_STATE, 0, 0, 0},
/* 124*/ {USER_INPUT_STATE, 0, 0, 0},
/* 125*/ {USER_INPUT_STATE, 0, 0, 0},
/* 126*/ {USER_INPUT_STATE, 0, legacy_irms_adc_result, 0},
/* 127*/ {USER_INPUT_STATE, 0, 0, 0},
/* 128*/ {LW_UI_STATE, 0, switch_to_legacy_wand, 0},
/* 129*/ {USER_INPUT_STATE, 0, check_electrode_error, 0},
/* 130*/ {USER_INPUT_STATE, 0, 0, 0},
/* 131*/ {FAULT_STATE, 0, legacy_wand_adc_fault, 0},
/* 132*/ {USER_INPUT_STATE, 0, 0, 0},
/* 133*/ {USER_INPUT_STATE, 0, lw_wand_expired_error, 0},
/* 134*/ {USER_INPUT_STATE, 0, 0, 0},
/* 135*/ {USER_INPUT_STATE, 0, 0, 0},
/* 136*/ {USER_INPUT_STATE, 0, 0, 0},
/* 137*/ {USER_INPUT_STATE, 0, 0, 0},
/* 138*/ {USER_INPUT_STATE, 0, log2sdhc, 0},
/* 139*/ {USER_INPUT_STATE, 0, lw_id_error, 0},
/* 140*/ {USER_INPUT_STATE, 0, lw_incompatible_error, 0},
/* 141*/ {IDLE_STATE, 0, 0, 0},
/* 142*/ {FAULT_STATE, 0, gen_com_fault, 0},
/* 143*/ {USER_INPUT_STATE, 0, 0, 0},
/* 144*/ {USER_INPUT_STATE, 0, 0, 0},
/* 145*/ {FAULT_STATE, 0, ui_fault, 0},
/* 146*/ {USER_INPUT_STATE, 0, pump_cmd_eack, 0},
/* 147*/ {USER_INPUT_STATE, 0, cbtmr_isr, 0},
/* 148*/ {USER_INPUT_STATE, 0, 0, 0},
/* 149*/ {USER_INPUT_STATE, 0, 0, 0},
/* 150*/ {USER_INPUT_STATE, 0, bdm_poll_usb, 0},
/* 151*/ {USER_INPUT_STATE, 0, 0, 0},
   },
   
/*******************************************************************************
 *                             THERAPY State                                   *
 ******************************************************************************/   
   {//Current_state, next_state, entry_func, action_on_event, exit_func
/* 1   */ {THERAPY_STATE, 0, 0, 0},
/* 2   */ {THERAPY_STATE, 0, 0, 0},
/* 3   */ {THERAPY_STATE, 0, 0, 0},
/* 4   */ {THERAPY_STATE, 0, 0, 0},
/* 5   */ {THERAPY_STATE, 0, 0, 0},
/* 6   */ {THERAPY_STATE, 0, 0, 0},
/* 7   */ {USER_INPUT_STATE, 0, wand_unlock, therapy_off},
/* 8   */ {THERAPY_STATE, 0, 0, 0},
/* 9   */ {THERAPY_STATE, 0, wand_periodic_packet_parse, 0},
/* 10  */ {THERAPY_STATE, 0, 0, 0},
/* 11  */ {THERAPY_STATE, 0, poll_footpedal, 0},
/* 12  */ {THERAPY_STATE, 0, set_volume, 0},
/* 13  */ {THERAPY_STATE, 0, reset_alarm_audio, 0},
/* 14  */ {THERAPY_STATE, 0, pump_speed_ctrl, 0},
/* 15  */ {THERAPY_STATE, 0, therapy_on, 0},
/* 16  */ {USER_INPUT_STATE, 0, therapy_off, 0},
/* 17  */ {THERAPY_STATE, 0, update_gui, 0},
/* 18  */ {THERAPY_STATE, 0, 0, 0},
/* 19  */ {SHUTDOWN_STATE, 0, poll_pwr_button, therapy_off},
/* 20  */ {THERAPY_STATE, 0, 0, 0},
/* 21  */ {THERAPY_STATE, 0, 0, 0},
/* 22  */ {THERAPY_STATE, 0, 0, 0},
/* 23  */ {THERAPY_STATE, 0, update_leds, 0},
/* 24  */ {USER_INPUT_STATE, 0, wand_disconnected_error, therapy_off},
/* 25  */ {THERAPY_STATE, 0, wand_tx, 0},
/* 26  */ {THERAPY_STATE, 0, smartwand_timeout, 0},
/* 27  */ {THERAPY_STATE, 0, poll_pump_sensors, 0},
/* 28  */ {THERAPY_STATE, 0, 0, 0},
/* 29  */ {THERAPY_STATE, 0, rf_on, 0},
/* 30  */ {THERAPY_STATE, 0, irms_overcurrent, 0},
/* 31  */ {THERAPY_STATE, 0, pump_inactivity_monitor, 0},
/* 32  */ {THERAPY_STATE, 0, poll_adc_data, 0},
/* 33  */ {THERAPY_STATE, 0, read_flexcan, 0},
/* 34  */ {THERAPY_STATE, 0, 0, 0},
/* 35  */ {THERAPY_STATE, 0, flexCAN_write_fast_msgs, 0},
/* 36  */ {THERAPY_STATE, 0, rf_off, 0},
/* 37  */ {THERAPY_STATE, 0, measure_z, 0},
#ifdef DEBUG_CAN
/* 38  */ {THERAPY_STATE, 0, flexCAN_write_pumpdebug, 0},
#else
/* 38  */ {THERAPY_STATE, 0, 0, 0},
#endif
/* 39 */ {THERAPY_STATE, 0, pump_cmd_ack, pump_packetizer},
/* 40 */ {THERAPY_STATE, 0, pump_reset, 0},
/* 41 */ {THERAPY_STATE, 0, pump_packetizer, 0},
/* 42 */ {THERAPY_STATE, 0, drive_status, 0},
/* 43 */ {THERAPY_STATE, 0, pump_cmd_nack, 0},
/* 44 */ {THERAPY_STATE, 0, can_wdog_rx, 0},
/* 45 */ {THERAPY_STATE, 0, 0, 0}, 
/* 46 */ {THERAPY_STATE, 0, 0, 0}, 
/* 47 */ {FAULT_STATE, 0, gui_com_fault, therapy_off}, 
/* 48 */ {USER_INPUT_STATE, 0, peak_hit_cntr, 0}, 
/* 49 */ {THERAPY_STATE, 0, 0, 0}, 
/* 50 */ {THERAPY_STATE, 0, 0, 0},
/* 51 */ {USER_INPUT_STATE, 0, suction_tube_error, therapy_off},
/* 52 */ {USER_INPUT_STATE, 0, no_ambient_error, therapy_off},
/* 53 */ {THERAPY_STATE, 0, adc3_coco, 0},
/* 54 */ {USER_INPUT_STATE, 0, internal_temp_error, therapy_off},
/* 55 */ {THERAPY_STATE, 0, 0, 0},
/* 56 */ {FAULT_STATE, 0, adc_boundary_fault, therapy_off},
/* 57 */ {THERAPY_STATE, 0, 0, 0},
/* 58 */ {FAULT_STATE, 0, pump_fault, therapy_off},
/* 59 */ {FAULT_STATE, 0, vmod_fault, therapy_off},
/* 60 */ {FAULT_STATE, 0,  internal_temp_fault, therapy_off},
/* 61 */ {THERAPY_STATE, 0,  irms2_adc_result, 0},
/* 62 */ {THERAPY_STATE, 0, 0, 0},
/* 63 */ {THERAPY_STATE, 0, 0, 0},
/* 64 */ {THERAPY_STATE, 0, 0, 0},
/* 65 */ {THERAPY_STATE, 0, 0, 0},
/* 66 */ {THERAPY_STATE, 0, 0, 0},
/* 67 */ {FAULT_STATE, 0, date_time_fault, 0},
/* 68 */ {THERAPY_STATE, 0, 0, 0},
/* 69 */ {THERAPY_STATE, 0, 0, 0},
/* 70 */ {THERAPY_STATE, 0, 0, 0},
/* 71 */ {THERAPY_STATE, 0, 0, 0},
/* 72 */ {THERAPY_STATE, 0, 0, 0},
/* 73 */ {THERAPY_STATE, 0, 0, 0},
/* 74 */ {THERAPY_STATE, 0, 0, 0},
/* 75 */ {THERAPY_STATE, 0, 0, 0},
/* 76 */ {THERAPY_STATE, 0, 0, 0},
/* 77 */ {THERAPY_STATE, 0, 0, 0},
/* 78 */ {THERAPY_STATE, 0, 0, 0},
/* 79 */ {THERAPY_STATE, 0, 0, 0},
/* 80 */ {THERAPY_STATE, 0, 0, 0},
/* 81 */ {THERAPY_STATE, 0, 0, 0},
/* 82 */ {THERAPY_STATE, 0, 0, 0},
/* 83 */ {THERAPY_STATE, 0, 0, 0},
/* 84 */ {THERAPY_STATE, 0, 0, 0},
/* 85 */ {THERAPY_STATE, 0, 0, 0},
/* 86 */ {THERAPY_STATE, 0, 0, 0},
/* 87 */ {THERAPY_STATE, 0, 0, 0},
/* 88 */ {THERAPY_STATE, 0, 0, 0},
/* 89 */ {THERAPY_STATE, 0, 0, 0},
/* 90 */ {THERAPY_STATE, 0, 0, 0},
/* 91 */ {THERAPY_STATE, 0, wdog_refresh, 0},
/* 92 */ {THERAPY_STATE, 0, 0, 0},
/* 93 */ {FAULT_STATE, 0, wand_switch_stuck_fault, therapy_off},
/* 94 */ {THERAPY_STATE, 0, 0, 0},
/* 95 */ {USER_INPUT_STATE, 0, wand_use_limit_error, therapy_off},
/* 96 */ {THERAPY_STATE, 0, wand_worn_use_limit, 0},
/* 97 */ {THERAPY_STATE, 0, 0, 0},
/* 98 */ {THERAPY_STATE, 0, 0, 0},
/* 99 */ {THERAPY_STATE, 0, over_current, 0},
/* 100*/ {THERAPY_STATE, 0, over_energy, 0},
/* 101*/ {THERAPY_STATE, 0, 0, 0},
/* 102*/ {THERAPY_STATE, 0, 0, 0},
/* 103*/ {THERAPY_STATE, 0, 0, 0},
/* 104*/ {THERAPY_STATE, 0, reset_pulse_cnt, 0},
/* 105*/ {THERAPY_STATE, 0, 0, 0},
/* 106*/ {THERAPY_STATE, 0, periodic_log_errors2wand, 0},
/* 107*/ {THERAPY_STATE, 0, buck_inactive_shutdown, 0},
/* 108*/ {THERAPY_STATE, 0, 0, 0},
/* 109*/ {THERAPY_STATE, 0, flexCAN_write_slow_msgs, 0},
/* 110*/ {THERAPY_STATE, 0, request_statusbytes, 0},
#ifdef DEBUG_CAN
/* 111*/ {THERAPY_STATE, 0, flexCAN_write_wireless, 0},
#else
/* 111*/ {THERAPY_STATE, 0, 0, 0},
#endif
/* 112*/ {THERAPY_STATE, 0, 0, 0},
/* 113*/ {THERAPY_STATE, 0, 0, 0},
/* 114*/ {THERAPY_STATE, 0, 0, 0},
/* 115*/ {THERAPY_STATE, 0, 0, 0},
/* 116*/ {THERAPY_STATE, 0, sd_card_rw, 0},
/* 117*/ {THERAPY_STATE, 0, wand_wear_monitor, 0},
#ifdef DEBUG_CAN
/* 118*/ {THERAPY_STATE, 0, flexCAN_write_wand_wear_debug, 0},
#else
/* 118*/ {THERAPY_STATE, 0, 0, 0},
#endif
/* 119*/ {THERAPY_STATE, 0, 0, 0}, // dont read legacy_wand_read_adc_values during therapy so we can avoid finger switches being disabled during therapy.
/* 120*/ {THERAPY_STATE, 0, 0, 0},
/* 121*/ {THERAPY_STATE, 0, 0, 0},
/* 122*/ {THERAPY_STATE, 0, 0, 0},
/* 123*/ {THERAPY_STATE, 0, 0, 0},
/* 124*/ {THERAPY_STATE, 0, 0, 0},
/* 125*/ {THERAPY_STATE, 0, 0, 0},
/* 126*/ {THERAPY_STATE, 0, 0, 0},
/* 127*/ {THERAPY_STATE, 0, 0, 0},
/* 128*/ {THERAPY_STATE, 0, state_switch, 0},
/* 129*/ {USER_INPUT_STATE, 0, check_electrode_error, therapy_off},
/* 130*/ {THERAPY_STATE, 0, 0, 0},
/* 131*/ {FAULT_STATE, 0, legacy_wand_adc_fault, 0},
/* 132*/ {THERAPY_STATE, 0, 0, 0},
/* 133*/ {THERAPY_STATE, 0, 0, 0},
/* 134*/ {THERAPY_STATE, 0, 0, 0},
/* 135*/ {THERAPY_STATE, 0, 0, 0},
/* 136*/ {THERAPY_STATE, 0, 0, 0},
/* 137*/ {THERAPY_STATE, 0, 0, 0},
/* 138*/ {THERAPY_STATE, 0, log2sdhc, 0},
/* 139*/ {THERAPY_STATE, 0, 0, 0},
/* 140*/ {THERAPY_STATE, 0, 0, 0},
/* 141*/ {THERAPY_STATE, 0, 0, 0},
/* 142*/ {FAULT_STATE, 0, gen_com_fault, therapy_off},
/* 143*/ {THERAPY_STATE, 0, 0, 0},
/* 144*/ {THERAPY_STATE, 0, 0, 0},
/* 145*/ {FAULT_STATE, 0, ui_fault, 0},
/* 146*/ {THERAPY_STATE, 0, pump_cmd_eack, 0},
/* 147*/ {THERAPY_STATE, 0, cbtmr_isr, 0},
/* 148*/ {THERAPY_STATE, 0, 0, 0},
/* 149*/ {THERAPY_STATE, 0, 0, 0},
/* 150*/ {THERAPY_STATE, 0, bdm_poll_usb, 0},
/* 151*/ {THERAPY_STATE, 0, 0, 0},
   },


/*******************************************************************************
 *                             FAULT State                                     *
 ******************************************************************************/      
   {//Current_state, next_state, entry_func, action_on_event, exit_func
/* 1   */ {FAULT_STATE, fault_init, 0, 0},
/* 2   */ {FAULT_STATE, 0, 0, 0},
/* 3   */ {FAULT_STATE, 0, 0, 0},
/* 4   */ {FAULT_STATE, 0, 0, 0},
/* 5   */ {FAULT_STATE, 0, 0, 0},
/* 6   */ {FAULT_STATE, 0, 0, 0},
/* 7   */ {FAULT_STATE, 0, 0, 0},
/* 8   */ {FAULT_STATE, 0, 0, 0},
/* 9   */ {FAULT_STATE, 0, 0, 0},
/* 10  */ {FAULT_STATE, 0, 0, 0},
/* 11  */ {FAULT_STATE, 0, 0, 0},
/* 12  */ {FAULT_STATE, 0, set_volume, 0},
/* 13  */ {FAULT_STATE, 0, 0, 0},
/* 14  */ {FAULT_STATE, 0, 0, 0},
/* 15  */ {FAULT_STATE, 0, 0, 0},
/* 16  */ {FAULT_STATE, 0, 0, 0},
/* 17  */ {FAULT_STATE, 0, 0, 0},
/* 18  */ {FAULT_STATE, 0, 0, 0},
/* 19  */ {SHUTDOWN_STATE, 0, poll_pwr_button, 0},
/* 20  */ {FAULT_STATE, 0, 0, 0},
/* 21  */ {FAULT_STATE, 0, 0, 0},
/* 22  */ {FAULT_STATE, 0, 0, 0},
/* 23  */ {FAULT_STATE, 0, update_leds, 0},
/* 24  */ {FAULT_STATE, 0, 0, 0},
/* 25  */ {FAULT_STATE, 0, 0, 0},
/* 26  */ {FAULT_STATE, 0, 0, 0},
/* 27  */ {FAULT_STATE, 0, 0, 0},
/* 28  */ {FAULT_STATE, 0, update_screen, 0},
/* 29  */ {FAULT_STATE, 0, 0, 0},
/* 30 */ {FAULT_STATE, 0, 0, 0},
/* 31 */ {FAULT_STATE, 0, 0, 0},
/* 32 */ {FAULT_STATE, 0, poll_adc_data, 0},
/* 33 */ {FAULT_STATE, 0, read_flexcan, 0},
/* 34  */ {FAULT_STATE, 0, 0, 0},
/* 35  */ {FAULT_STATE, 0, flexCAN_write_fast_msgs, 0},
/* 36  */ {FAULT_STATE, 0, 0, 0},
/* 37  */ {FAULT_STATE, 0, 0, 0},
/* 38  */ {FAULT_STATE, 0, 0, 0},
/* 39 */ {FAULT_STATE, 0, pump_cmd_ack, 0},
/* 40 */ {FAULT_STATE, 0, pump_reset, 0},
/* 41 */ {FAULT_STATE, 0, 0, 0},
/* 42 */ {FAULT_STATE, 0, drive_status, 0},
/* 43 */ {FAULT_STATE, 0, pump_cmd_nack, 0},
/* 44 */ {FAULT_STATE, 0, can_wdog_rx, 0},
/* 45 */ {FAULT_STATE, 0, 0, 0}, 
/* 46 */ {FAULT_STATE, 0, 0, 0}, 
/* 47 */ {FAULT_STATE, 0, can_timeout, 0}, 
/* 48 */ {FAULT_STATE, 0, 0, 0}, 
/* 49 */ {FAULT_STATE, 0, 0, 0}, 
/* 50 */ {FAULT_STATE, 0, 0, 0},
/* 51 */ {FAULT_STATE, 0, 0, 0},
/* 52 */ {FAULT_STATE, 0, 0, 0},
/* 53 */ {FAULT_STATE, 0, adc0_coco_stator, 0},
/* 54 */ {FAULT_STATE, 0, 0, 0},
/* 55 */ {FAULT_STATE, 0, 0, 0},
/* 56 */ {FAULT_STATE, 0, 0, 0},
/* 57 */ {FAULT_STATE, 0, 0, 0},
/* 58 */ {FAULT_STATE, 0, 0, 0},
/* 59 */ {FAULT_STATE, 0, 0, 0},
/* 60 */ {FAULT_STATE, 0, 0, 0},
/* 61 */ {FAULT_STATE, 0, 0, 0},
/* 62 */ {FAULT_STATE, 0, 0, 0},
/* 63 */ {FAULT_STATE, 0, 0, 0},
/* 64 */ {FAULT_STATE, 0, 0, 0},
/* 65 */ {FAULT_STATE, 0, 0, 0},
/* 66 */ {FAULT_STATE, 0, 0, 0},
/* 67 */ {FAULT_STATE, 0, date_time_fault, 0},
/* 68 */ {FAULT_STATE, 0, 0, 0},
/* 69 */ {FAULT_STATE, 0, 0, 0},
/* 70 */ {FAULT_STATE, 0, 0, 0},
/* 71 */ {FAULT_STATE, 0, 0, 0},
/* 72 */ {FAULT_STATE, 0, 0, 0},
/* 73 */ {FAULT_STATE, 0, 0, 0},
/* 74 */ {FAULT_STATE, 0, 0, 0},
/* 75 */ {FAULT_STATE, 0, 0, 0},
/* 76 */ {FAULT_STATE, 0, 0, 0},
/* 77 */ {FAULT_STATE, 0, 0, 0},
/* 78 */ {FAULT_STATE, 0, 0, 0},
/* 79 */ {FAULT_STATE, 0, 0, 0},
/* 80 */ {FAULT_STATE, 0, 0, 0},
/* 81 */ {FAULT_STATE, 0, 0, 0},
/* 82 */ {FAULT_STATE, 0, 0, 0},
/* 83 */ {FAULT_STATE, 0, 0, 0},
/* 84 */ {FAULT_STATE, 0, 0, 0},
/* 85 */ {FAULT_STATE, 0, 0, 0},
/* 86 */ {FAULT_STATE, 0, 0, 0},
/* 87 */ {FAULT_STATE, 0, 0, 0},
/* 88 */ {FAULT_STATE, 0, 0, 0},
/* 89 */ {FAULT_STATE, 0, 0, 0},
/* 90 */ {FAULT_STATE, 0, 0, 0},
/* 91 */ {FAULT_STATE, 0, wdog_refresh, 0},
/* 92 */ {FAULT_STATE, 0, 0, 0},
/* 93 */ {FAULT_STATE, 0, 0, 0},
/* 94 */ {FAULT_STATE, 0, 0, 0},
/* 95 */ {FAULT_STATE, 0, wand_use_limit_error, 0},
/* 96 */ {FAULT_STATE, 0, wand_use_limit_check, 0},
/* 97 */ {FAULT_STATE, 0, 0, 0},
/* 98 */ {FAULT_STATE, 0, 0, 0},
/* 99 */ {FAULT_STATE, 0, 0, 0},
/* 100*/ {FAULT_STATE, 0, 0, 0},
/* 101*/ {FAULT_STATE, 0, 0, 0},
/* 102*/ {FAULT_STATE, 0, 0, 0},
/* 103*/ {FAULT_STATE, 0, 0, 0},
/* 104*/ {FAULT_STATE, 0, 0, 0},
/* 105*/ {FAULT_STATE, 0, 0, 0},
/* 106*/ {FAULT_STATE, 0, 0, 0},
/* 107*/ {FAULT_STATE, 0, buck_inactive_shutdown, 0},
/* 108*/ {FAULT_STATE, 0, 0, 0},
/* 109*/ {FAULT_STATE, 0, flexCAN_write_slow_msgs, 0},
/* 110*/ {FAULT_STATE, 0, 0, 0},
/* 111*/ {FAULT_STATE, 0, 0, 0},
/* 112*/ {FAULT_STATE, 0, 0, 0},
/* 113*/ {FAULT_STATE, 0, 0, 0},
/* 114*/ {FAULT_STATE, 0, 0, 0},
/* 115*/ {FAULT_STATE, 0, 0, 0},
/* 116*/ {FAULT_STATE, 0, sd_card_rw, 0},
/* 117*/ {FAULT_STATE, 0, 0, 0},
/* 118*/ {FAULT_STATE, 0, 0, 0},
/* 119*/ {FAULT_STATE, 0, 0, 0},
/* 120*/ {FAULT_STATE, 0, 0, 0},
/* 121*/ {FAULT_STATE, 0, 0, 0},
/* 122*/ {FAULT_STATE, 0, 0, 0},
/* 123*/ {FAULT_STATE, 0, 0, 0},
/* 124*/ {FAULT_STATE, 0, 0, 0},
/* 125*/ {FAULT_STATE, 0, 0, 0},
/* 126*/ {FAULT_STATE, 0, 0, 0},
/* 127*/ {FAULT_STATE, 0, 0, 0},
/* 128*/ {FAULT_STATE, 0, 0, 0},
/* 129*/ {FAULT_STATE, 0, 0, 0},
/* 130*/ {FAULT_STATE, 0, 0, 0},
/* 131*/ {FAULT_STATE, 0, 0, 0},
/* 132*/ {FAULT_STATE, 0, 0, 0},
/* 133*/ {FAULT_STATE, 0, 0, 0},
/* 134*/ {FAULT_STATE, 0, 0, 0},
/* 135*/ {FAULT_STATE, 0, 0, 0},
/* 136*/ {FAULT_STATE, 0, 0, 0},
/* 137*/ {FAULT_STATE, 0, 0, 0},
/* 138*/ {FAULT_STATE, 0, log2sdhc, 0},
/* 139*/ {FAULT_STATE, 0, 0, 0},
/* 140*/ {FAULT_STATE, 0, 0, 0},
/* 141*/ {FAULT_STATE, 0, 0, 0},
/* 142*/ {FAULT_STATE, 0, 0, 0},
/* 143*/ {FAULT_STATE, 0, 0, 0},
/* 144*/ {FAULT_STATE, 0, 0, 0},
/* 145*/ {FAULT_STATE, 0, ui_fault, 0},
/* 146*/ {FAULT_STATE, 0, 0, 0},
/* 147*/ {FAULT_STATE, 0, 0, 0},
/* 148*/ {FAULT_STATE, 0, 0, 0},
/* 149*/ {FAULT_STATE, 0, 0, 0},
/* 150*/ {FAULT_STATE, 0, bdm_poll_usb, 0},
/* 151*/ {FAULT_STATE, 0, 0, 0},
   },
   
/*******************************************************************************
 *                        SHUTDOWN_STATE State                                 *
 ******************************************************************************/         
   {//Current_state, next_state, entry_func, action_on_event, exit_func
/* 1   */ {SHUTDOWN_STATE, init_shutdown, 0, 0},
/* 2   */ {SHUTDOWN_STATE, 0, 0, 0},
/* 3   */ {SHUTDOWN_STATE, 0, 0, 0},
/* 4   */ {SHUTDOWN_STATE, 0, 0, 0},
/* 5   */ {SHUTDOWN_STATE, 0, 0, 0},
/* 6   */ {SHUTDOWN_STATE, 0, 0, 0},
/* 7   */ {SHUTDOWN_STATE, 0, 0, 0},
/* 8   */ {SHUTDOWN_STATE, 0, 0, 0},
/* 9   */ {SHUTDOWN_STATE, 0, 0, 0},
/* 10  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 11  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 12  */ {SHUTDOWN_STATE, 0, set_volume, 0},
/* 13  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 14  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 15  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 16  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 17  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 18  */ {SHUTDOWN_STATE, 0, power_board_on, init_manager},
/* 19  */ {SHUTDOWN_STATE, 0, poll_pwr_button, 0},
/* 20  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 21  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 22  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 23  */ {SHUTDOWN_STATE, 0, shutdown_led_sequence, 0},
/* 24  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 25  */ {SHUTDOWN_STATE, 0, wand_lock, 0},
/* 26  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 27  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 28  */ {SHUTDOWN_STATE, 0, update_screen, 0},
/* 29  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 30 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 31 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 32 */ {SHUTDOWN_STATE, 0, poll_adc_data, 0},
/* 33 */ {SHUTDOWN_STATE, 0, read_flexcan, 0},
/* 34  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 35  */ {SHUTDOWN_STATE, 0, flexCAN_write_fast_msgs, 0},
/* 36  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 37  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 38  */ {SHUTDOWN_STATE, 0, 0, 0},
/* 39 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 40 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 41 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 42 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 43 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 44 */ {SHUTDOWN_STATE, 0, can_wdog_rx, 0},
/* 45 */ {SHUTDOWN_STATE, 0, 0, 0}, 
/* 46 */ {SHUTDOWN_STATE, 0, 0, 0}, 
/* 47 */ {SHUTDOWN_STATE, 0, 0, 0}, 
/* 48 */ {SHUTDOWN_STATE, 0, 0, 0}, 
/* 49 */ {SHUTDOWN_STATE, 0, 0, 0}, 
/* 50 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 51 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 52 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 53 */ {SHUTDOWN_STATE, 0, adc3_coco, 0},
/* 54 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 55 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 56 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 57 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 58 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 59 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 60 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 61 */ {SHUTDOWN_STATE, 0,  0, 0},
/* 62 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 63 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 64 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 65 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 66 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 67 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 68 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 69 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 70 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 71 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 72 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 73 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 74 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 75 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 76 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 77 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 78 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 79 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 80 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 81 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 82 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 83 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 84 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 85 */ {SHUTDOWN_STATE, 0, led_init, init_manager},
/* 86 */ {SHUTDOWN_STATE, 0, legacy_wand_init, init_manager},
/* 87 */ {SHUTDOWN_STATE, 0, zigbee_init, init_manager},
/* 88 */ {SHUTDOWN_STATE, 0, esdhc_init, init_manager},
/* 89 */ {SHUTDOWN_STATE, 0, audio_amp_init, init_manager},
/* 90 */ {STARTUP_STATE, 0, init_manager, 0},
/* 91 */ {SHUTDOWN_STATE, 0, wdog_refresh, 0},
/* 92 */ {SHUTDOWN_STATE, 0, save_params2flash, psu_off},
/* 93 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 94 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 95 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 96 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 97 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 98 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 99 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 100 */ {SHUTDOWN_STATE, 0, 0, 0},
/* 101*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 102*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 103*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 104*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 105*/ {SHUTDOWN_STATE, 0, system_reset, 0},
/* 106*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 107*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 108*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 109*/ {SHUTDOWN_STATE, 0, flexCAN_write_slow_msgs, 0},
/* 110*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 111*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 112*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 113*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 114*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 115*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 116*/ {SHUTDOWN_STATE, 0, sd_card_init_callback, init_manager},
/* 117*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 118*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 119*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 120*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 121*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 122*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 123*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 124*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 125*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 126*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 127*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 128*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 129*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 130*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 131*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 132*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 133*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 134*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 135*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 136*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 137*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 138*/ {SHUTDOWN_STATE, 0, log2sdhc, 0},
/* 139*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 140*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 141*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 142*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 143*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 144*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 145*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 146*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 147*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 148*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 149*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 150*/ {SHUTDOWN_STATE, 0, 0, 0},
/* 151*/ {SHUTDOWN_STATE, 0, 0, 0},
   },
   

/*******************************************************************************
 *                           SW_UPDATE State                                   *
 ******************************************************************************/         
   {//Current_state, next_state, entry_func, action_on_event, exit_func
/* 1  */ {SW_UPDATE_STATE, 0, 0, 0},
/* 2  */ {SW_UPDATE_STATE, 0, 0, 0},
/* 3  */ {SW_UPDATE_STATE, 0, 0, 0},
/* 4  */ {SW_UPDATE_STATE, 0, 0, 0},
/* 5  */ {SW_UPDATE_STATE, 0, 0, 0},
/* 6  */ {SW_UPDATE_STATE, 0, 0, 0},
/* 7  */ {SW_UPDATE_STATE, 0, 0, 0},
/* 8  */ {SW_UPDATE_STATE, 0, 0, 0},
/* 9  */ {SW_UPDATE_STATE, 0, 0, 0},
/* 10 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 11 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 12 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 13 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 14 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 15 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 16 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 17 */ {SW_UPDATE_STATE, 0, update_gui, 0},
/* 18 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 19 */ {SHUTDOWN_STATE, 0, poll_pwr_button, 0},
/* 20 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 21 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 22 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 23 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 24 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 25 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 26 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 27 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 28 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 29 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 30 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 31 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 32 */ {SW_UPDATE_STATE, 0, poll_adc_data, 0},
/* 33 */ {SW_UPDATE_STATE, 0, read_flexcan, 0},
/* 34 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 35 */ {SW_UPDATE_STATE, 0, flexCAN_write_fast_msgs, 0},
/* 36 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 37 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 38 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 39 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 40 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 41 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 42 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 43 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 44 */ {SW_UPDATE_STATE, 0, can_wdog_rx, 0},
/* 45 */ {SW_UPDATE_STATE, 0, 0, 0}, 
/* 46 */ {SW_UPDATE_STATE, 0, 0, 0}, 
/* 47 */ {SW_UPDATE_STATE, 0, 0, 0}, 
/* 48 */ {SW_UPDATE_STATE, 0, 0, 0}, 
/* 49 */ {SW_UPDATE_STATE, 0, 0, 0}, 
/* 50 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 51 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 52 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 53 */ {SW_UPDATE_STATE, 0, adc3_coco, 0},
/* 54 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 55 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 56 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 57 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 58 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 59 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 60 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 61 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 62 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 63 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 64 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 65 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 66 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 67 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 68 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 69 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 70 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 71 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 72 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 73 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 74 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 75 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 76 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 77 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 78 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 79 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 80 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 81 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 82 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 83 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 84 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 85 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 86 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 87 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 88 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 89 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 90 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 91 */ {SW_UPDATE_STATE, 0, wdog_refresh, 0},
/* 92 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 93 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 94 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 95 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 96 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 97 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 98 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 99 */ {SW_UPDATE_STATE, 0, 0, 0},
/* 100*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 101*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 102*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 103*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 104*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 105*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 106*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 107*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 108*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 109*/ {SW_UPDATE_STATE, 0, flexCAN_write_slow_msgs, 0},
/* 110*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 111*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 112*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 113*/ {SW_UPDATE_STATE, 0, ui_update_status, 0},
/* 114*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 115*/ {IDLE_STATE, 0, commence_gs_sw_update, 0},
/* 116*/ {SW_UPDATE_STATE, 0, download_sdhc_data, 0},
/* 117*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 118*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 119*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 120*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 121*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 122*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 123*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 124*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 125*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 126*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 127*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 128*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 129*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 130*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 131*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 132*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 133*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 134*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 135*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 136*/ {SW_UPDATE_STATE, 0, cancel_sw_update, 0},
/* 137*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 138*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 139*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 140*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 141*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 142*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 143*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 144*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 145*/ {FAULT_STATE, 0, ui_fault, 0},
/* 146*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 147*/ {SW_UPDATE_STATE, 0, ui_gs_firmware_update_pause, 0},
/* 148*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 149*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 150*/ {SW_UPDATE_STATE, 0, 0, 0},
/* 151*/ {SW_UPDATE_STATE, 0, 0, 0},
   },
   
{ //Current_state, next_state, entry_func, action_on_event, exit_func
/* 1  */ {LW_UI_STATE, 0, 0, 0},
/* 2  */ {LW_UI_STATE, 0, wand_download_parm_pg_1, 0},
/* 3  */ {LW_UI_STATE, 0, wand_download_parm_pg_2, 0},
/* 4  */ {LW_UI_STATE, 0, wand_download_parm_pg_3, 0},
/* 5  */ {LW_UI_STATE, 0, wand_download_parm_pg_4, 0},
/* 6  */ {LW_UI_STATE, 0, wand_validate, 0},
/* 7  */ {LW_UI_STATE, 0, wand_unlock, 0},
/* 8  */ {LW_UI_STATE, 0, wand_download_parm_pg_0, 0},
/* 9  */ {LW_UI_STATE, 0, wand_not_active_periodic_packet_parse, 0},
/* 10 */ {USER_INPUT_STATE, 0, switch_to_ww_wand, 0},
/* 11 */ {LW_UI_STATE, 0, poll_footpedal, 0},
/* 12 */ {LW_UI_STATE, 0, set_volume, 0},
/* 13 */ {LW_UI_STATE, 0, reset_alarm_audio, 0},
/* 14 */ {LW_UI_STATE, 0, pump_speed_ctrl, 0},
/* 15 */ {LW_THERAPY_STATE, 0, legacy_wand_therapy_on, 0},
/* 16 */ {LW_UI_STATE, 0, 0, 0},
/* 17 */ {LW_UI_STATE, 0, update_gui, 0},
/* 18 */ {LW_UI_STATE, 0, 0, 0},
/* 19 */ {SHUTDOWN_STATE, 0, poll_pwr_button, 0},
/* 20 */ {LW_UI_STATE, 0, 0, 0},
/* 21 */ {FAULT_STATE, 0, 0, 0},
/* 22 */ {LW_UI_STATE, 0, 0, 0},
/* 23 */ {LW_UI_STATE, 0, update_leds, 0},
/* 24 */ {LW_UI_STATE, 0, wand_lock, 0},
/* 25 */ {LW_UI_STATE, 0, wand_tx, 0},
/* 26 */ {LW_UI_STATE, 0, smartwand_timeout, 0},
/* 27 */ {LW_UI_STATE, 0, poll_pump_sensors, 0},
/* 28 */ {LW_UI_STATE, 0, update_screen, 0},
/* 29 */ {LW_UI_STATE, 0, 0, 0},
/* 30 */ {LW_UI_STATE, 0, irms_overcurrent, 0},
/* 31 */ {LW_UI_STATE, 0, pump_inactivity_monitor, 0},
/* 32 */ {LW_UI_STATE, 0, poll_adc_data, 0},
/* 33 */ {LW_UI_STATE, 0, read_flexcan, 0},
/* 34 */ {LW_UI_STATE, 0, audible_click, 0},
/* 35 */ {LW_UI_STATE, 0, flexCAN_write_fast_msgs, 0},
/* 36 */ {LW_UI_STATE, 0, 0, 0},
/* 37 */ {LW_UI_STATE, 0, 0, 0},
#ifdef DEBUG_CAN
/* 38 */ {LW_UI_STATE, 0, flexCAN_write_pumpdebug, 0},
#else
/* 38 */ {LW_UI_STATE, 0, 0, 0},
#endif
/* 39 */ {LW_UI_STATE, 0, pump_cmd_ack, pump_packetizer},
/* 40 */ {LW_UI_STATE, 0, pump_reset, 0},
/* 41 */ {LW_UI_STATE, 0, pump_packetizer, 0},
/* 42 */ {LW_UI_STATE, 0, drive_status, 0},
/* 43 */ {LW_UI_STATE, 0, pump_cmd_nack, 0},
/* 44 */ {LW_UI_STATE, 0, can_wdog_rx, 0},
/* 45 */ {LW_UI_STATE, 0, 0, 0}, 
/* 46 */ {LW_UI_STATE, 0, 0, 0}, 
/* 47 */ {FAULT_STATE, 0, gui_com_fault, 0},
/* 48 */ {LW_UI_STATE, 0, legacy_wand_short_error, 0}, 
/* 49 */ {LW_UI_STATE, 0, 0, 0},
/* 50 */ {LW_UI_STATE, 0, reset_error, 0},
/* 51 */ {LW_UI_STATE, 0, suction_tube_error, 0},
/* 52 */ {LW_UI_STATE, 0, 0, 0},
/* 53 */ {LW_UI_STATE, 0, adc3_coco, 0},
/* 54 */ {LW_UI_STATE, 0, internal_temp_error, 0},
/* 55 */ {LW_UI_STATE, 0, clear_internal_temp_error, 0},
/* 56 */ {FAULT_STATE, 0, adc_boundary_fault, 0},
/* 57 */ {LW_UI_STATE, 0, 0, 0},
/* 58 */ {FAULT_STATE, 0, pump_fault, 0},
/* 59 */ {FAULT_STATE, 0, vmod_fault, 0},
/* 60 */ {FAULT_STATE, 0,  internal_temp_fault, 0},
/* 61 */ {LW_UI_STATE, 0, irms2_adc_result, 0},
/* 62 */ {LW_UI_STATE, 0, wand_static_read, 0},
/* 63 */ {LW_UI_STATE, 0, wand_static_write, 0},
/* 64 */ {USER_INPUT_STATE, 0, wand_circle_log_read, switch_to_ww_wand},
/* 65 */ {LW_UI_STATE, 0, 0, 0},
/* 66 */ {LW_UI_STATE, 0, 0, 0},
/* 67 */ {LW_UI_STATE, 0, date_time_fault, 0},
/* 68 */ {LW_UI_STATE, 0, 0, 0},
/* 69 */ {LW_UI_STATE, 0, 0, 0},
/* 70 */ {LW_UI_STATE, 0, 0, 0},
/* 71 */ {LW_UI_STATE, 0, 0, 0},
/* 72 */ {LW_UI_STATE, 0, 0, 0},
/* 73 */ {LW_UI_STATE, 0, 0, 0},
/* 74 */ {LW_UI_STATE, 0, 0, 0},
/* 75 */ {LW_UI_STATE, 0, 0, 0},
/* 76 */ {LW_UI_STATE, 0, 0, 0},
/* 77 */ {LW_UI_STATE, 0, 0, 0},
/* 78 */ {LW_UI_STATE, 0, 0, 0},
/* 79 */ {LW_UI_STATE, 0, 0, 0},
/* 80 */ {LW_UI_STATE, 0, 0, 0},
/* 81 */ {LW_UI_STATE, 0, 0, 0},
/* 82 */ {LW_UI_STATE, 0, 0, 0},
/* 83 */ {LW_UI_STATE, 0, 0, 0},
/* 84 */ {LW_UI_STATE, 0, 0, 0},
/* 85 */ {LW_UI_STATE, 0, 0, 0},
/* 86 */ {LW_UI_STATE, 0, 0, 0},
/* 87 */ {LW_UI_STATE, 0, 0, 0},
/* 88 */ {LW_UI_STATE, 0, 0, 0},
/* 89 */ {LW_UI_STATE, 0, 0, 0},
/* 90 */ {LW_UI_STATE, 0, 0, 0},
/* 91 */ {LW_UI_STATE, 0, wdog_refresh, 0},
/* 92 */ {LW_UI_STATE, 0, 0, 0},
/* 93 */ {LW_UI_STATE, 0, wand_switch_stuck_fault, 0},
/* 94 */ {LW_UI_STATE, 0, wand_expired_error , 0},
/* 95 */ {LW_UI_STATE, 0, wand_use_limit_error, 0},
/* 96 */ {LW_UI_STATE, 0, wand_use_limit_check, 0},
/* 97 */ {LW_UI_STATE, 0, wand_id_error, 0},
/* 98 */ {LW_UI_STATE , 0, 0, 0},
/* 99 */ {LW_UI_STATE, 0, 0, 0},
/* 100*/ {LW_UI_STATE, 0, 0, 0},
/* 101*/ {LW_UI_STATE, 0, 0, 0},
/* 102*/ {LW_UI_STATE, 0, 0, 0},
#ifdef DEBUG_CAN
/* 103*/ {LW_UI_STATE, 0, flexCAN_write_wanddebug, 0},
#else
/* 103*/ {LW_UI_STATE, 0, 0, 0},
#endif
/* 104*/ {LW_UI_STATE, 0, reset_pulse_cnt, 0},
/* 105*/ {LW_UI_STATE, 0, 0, 0},
/* 106*/ {LW_UI_STATE, 0, 0, 0},
/* 107*/ {LW_UI_STATE, 0, buck_inactive_shutdown, 0},
/* 108*/ {LW_UI_STATE, 0, wand_circle_write, 0},
/* 109*/ {LW_UI_STATE, 0, flexCAN_write_slow_msgs, 0},
/* 110*/ {LW_UI_STATE, 0, request_statusbytes, 0},
#ifdef DEBUG_CAN
/* 111*/ {LW_UI_STATE, 0, flexCAN_write_wireless, 0},
#else
/* 111*/ {LW_UI_STATE, 0, 0, 0},
#endif
/* 112*/ {LW_UI_STATE, 0, wireless_handshake, 0},
/* 113*/ {LW_UI_STATE, 0, 0, 0},
/* 114*/ {LW_UI_STATE, 0, 0, 0},
/* 115*/ {LW_UI_STATE, 0, 0, 0},
/* 116*/ {LW_UI_STATE, 0, sd_card_rw, 0},
/* 117*/ {LW_UI_STATE, 0, 0, 0},
/* 118*/ {LW_UI_STATE, 0, 0, 0},
/* 119*/ {LW_UI_STATE, 0, legacy_wand_read_adc_values, 0},
/* 120*/ {LW_THERAPY_STATE, 0, legacy_wand_therapy_on, 0},
/* 121*/ {LW_THERAPY_STATE, 0, legacy_wand_therapy_on, 0},
/* 122*/ {LW_UI_STATE, 0, increment_mode, 0},
/* 123*/ {LW_UI_STATE, 0, 0, 0},
/* 124*/ {LW_UI_STATE, 0, 0, 0},
/* 125*/ {LW_UI_STATE, 0, 0, 0},
/* 126*/ {LW_UI_STATE, 0, legacy_irms_adc_result, 0},
/* 127*/ {LW_UI_STATE, 0, legacy_irms_over_energy, 0},
/* 128*/ {LW_UI_STATE, 0, 0, 0},
/* 129*/ {LW_UI_STATE, 0, 0, 0},
/* 130*/ {IDLE_STATE, 0, legacy_wand_unplugged, 0},
/* 131*/ {FAULT_STATE, 0, legacy_wand_adc_fault, 0},
/* 132*/ {LW_UI_STATE, 0, 0, 0},
/* 133*/ {IDLE_STATE, 0, lw_wand_expired_error, 0},
/* 134*/ {LW_UI_STATE, 0, lw_wand_use_limit_error, 0},
/* 135*/ {LW_UI_STATE, 0, lw_ambient_sensor, 0},
/* 136*/ {LW_UI_STATE, 0, cancel_sw_update, 0},
/* 137*/ {LW_UI_STATE, 0, 0, 0},
/* 138*/ {LW_UI_STATE, 0, log2sdhc, 0},
/* 139*/ {LW_UI_STATE, 0, lw_id_error, 0},
/* 140*/ {LW_UI_STATE, 0, lw_incompatible_error, 0},
/* 141*/ {LW_UI_STATE, 0, 0, 0},
/* 142*/ {FAULT_STATE, 0, gen_com_fault, 0},
/* 143*/ {LW_UI_STATE, 0, 0, 0},
/* 144*/ {LW_UI_STATE, 0, 0, 0},
/* 145*/ {FAULT_STATE, 0, ui_fault, 0},
/* 146*/ {LW_UI_STATE, 0, pump_cmd_eack, 0},
/* 147*/ {LW_UI_STATE, 0, cbtmr_isr, 0},
/* 148*/ {USER_INPUT_STATE, 0, legacy_wand_unplugged, 0},
/* 149*/ {USER_INPUT_STATE, 0, switch_to_ww_wand, 0 },
/* 150*/ {LW_UI_STATE, 0, bdm_poll_usb, 0},
/* 151*/ {LW_UI_STATE, 0, 0, 0},

   },
   
   {//Current_state, next_state, entry_func, action_on_event, exit_func
/* 1   */ {LW_THERAPY_STATE, 0, 0, 0},
/* 2   */ {LW_THERAPY_STATE, 0, 0, 0},
/* 3   */ {LW_THERAPY_STATE, 0, 0, 0},
/* 4   */ {LW_THERAPY_STATE, 0, 0, 0},
/* 5   */ {LW_THERAPY_STATE, 0, 0, 0},
/* 6   */ {LW_THERAPY_STATE, 0, 0, 0},
/* 7   */ {USER_INPUT_STATE, 0, 0, legacy_wand_therapy_off},
/* 8   */ {LW_THERAPY_STATE, 0, 0, 0},
/* 9   */ {LW_THERAPY_STATE, 0, 0, 0},
/* 10  */ {LW_THERAPY_STATE, 0, 0, 0},
/* 11  */ {LW_THERAPY_STATE, 0, poll_footpedal, 0},
/* 12  */ {LW_THERAPY_STATE, 0, set_volume, 0},
/* 13  */ {LW_THERAPY_STATE, 0, reset_alarm_audio, 0},
/* 14  */ {LW_THERAPY_STATE, 0, pump_speed_ctrl, 0},
/* 15  */ {LW_THERAPY_STATE, 0, 0, 0},
/* 16  */ {LW_THERAPY_STATE, 0, 0, 0},
/* 17  */ {LW_THERAPY_STATE, 0, update_gui, 0},
/* 18  */ {LW_THERAPY_STATE, 0, 0, 0},
/* 19  */ {SHUTDOWN_STATE, 0, poll_pwr_button, legacy_wand_therapy_off},
/* 20  */ {LW_THERAPY_STATE, 0, 0, 0},
/* 21  */ {FAULT_STATE, 0, 0, 0},
/* 22  */ {LW_THERAPY_STATE, 0, 0, 0},
/* 23  */ {LW_THERAPY_STATE, 0, update_leds, 0},
/* 24  */ {LW_THERAPY_STATE, 0, 0, 0},
/* 25  */ {LW_THERAPY_STATE, 0, 0, 0},
/* 26  */ {LW_THERAPY_STATE, 0, 0, 0},
/* 27  */ {LW_THERAPY_STATE, 0, poll_pump_sensors, 0},
/* 28  */ {LW_THERAPY_STATE, 0, 0, 0},
/* 29  */ {LW_THERAPY_STATE, 0, lw_rf_on, 0},
/* 30 */ {LW_THERAPY_STATE, 0, 0, 0},//irms_overcurrent
/* 31 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 32 */ {LW_THERAPY_STATE, 0, poll_adc_data, 0},
/* 33 */ {LW_THERAPY_STATE, 0, read_flexcan, 0},
/* 34  */ {LW_THERAPY_STATE, 0, 0, 0},
/* 35  */ {LW_THERAPY_STATE, 0, flexCAN_write_fast_msgs, 0},
/* 36  */ {LW_THERAPY_STATE, 0, lw_rf_off, 0},
/* 37  */ {LW_THERAPY_STATE, 0, measure_z, 0},
#ifdef DEBUG_CAN
/* 38  */ {LW_THERAPY_STATE, 0, flexCAN_write_pumpdebug, 0},
#else
/* 38  */ {LW_THERAPY_STATE, 0, 0, 0},
#endif
/* 39 */ {LW_THERAPY_STATE, 0, pump_cmd_ack, pump_packetizer},
/* 40 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 41 */ {LW_THERAPY_STATE, 0, pump_packetizer, 0},
/* 42 */ {LW_THERAPY_STATE, 0, drive_status, 0},
/* 43 */ {LW_THERAPY_STATE, 0, pump_cmd_nack, 0},
/* 44 */ {LW_THERAPY_STATE, 0, can_wdog_rx, 0},
/* 45 */ {LW_THERAPY_STATE, 0, 0, 0}, 
/* 46 */ {LW_THERAPY_STATE, 0, 0, 0}, 
/* 47 */ {FAULT_STATE, 0, gui_com_fault, legacy_wand_therapy_off}, 
/* 48 */ {LW_UI_STATE, 0, legacy_wand_short_error, legacy_wand_therapy_off}, 
/* 49 */ {LW_THERAPY_STATE, 0, 0, 0}, 
/* 50 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 51 */ {USER_INPUT_STATE, 0, suction_tube_error, legacy_wand_therapy_off},
/* 52 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 53 */ {LW_THERAPY_STATE, 0, adc3_coco, 0},
/* 54 */ {USER_INPUT_STATE, 0, internal_temp_error, legacy_wand_therapy_off},
/* 55 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 56 */ {FAULT_STATE, 0, adc_boundary_fault, legacy_wand_therapy_off},
/* 57 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 58 */ {FAULT_STATE, 0, pump_fault, legacy_wand_therapy_off},
/* 59 */ {FAULT_STATE, 0, vmod_fault, legacy_wand_therapy_off},
/* 60 */ {FAULT_STATE, 0,  internal_temp_fault, legacy_wand_therapy_off},
/* 61 */ {LW_THERAPY_STATE, 0, 0, 0}, //irms2_adc_result
/* 62 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 63 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 64 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 65 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 66 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 67 */ {FAULT_STATE, 0, date_time_fault, 0},
/* 68 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 69 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 70 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 71 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 72 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 73 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 74 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 75 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 76 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 77 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 78 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 79 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 80 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 81 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 82 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 83 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 84 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 85 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 86 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 87 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 88 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 89 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 90 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 91 */ {LW_THERAPY_STATE, 0, wdog_refresh, 0},
/* 92 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 93 */ {LW_THERAPY_STATE, 0,0,0},
/* 94 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 95 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 96 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 97 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 98 */ {LW_THERAPY_STATE, 0, 0, 0},
/* 99 */ {LW_THERAPY_STATE, 0, over_energy, 0},
/* 100*/ {LW_THERAPY_STATE, 0, over_current, 0},
/* 101*/ {LW_THERAPY_STATE, 0, 0, 0},
/* 102*/ {LW_THERAPY_STATE, 0, 0, 0},
/* 103*/ {LW_THERAPY_STATE, 0, 0, 0},
/* 104*/ {LW_THERAPY_STATE, 0, reset_pulse_cnt, 0},
/* 105*/ {LW_THERAPY_STATE, 0, 0, 0},
/* 106*/ {LW_THERAPY_STATE, 0, 0, 0},
/* 107*/ {LW_THERAPY_STATE, 0, buck_inactive_shutdown, 0},
/* 108*/ {LW_UI_STATE, 0, 0, 0},
/* 109*/ {LW_UI_STATE, 0, flexCAN_write_slow_msgs, 0},
/* 110*/ {LW_THERAPY_STATE, 0, request_statusbytes, 0},
/* 111*/ {LW_UI_STATE, 0, 0, 0},
/* 112*/ {LW_UI_STATE, 0, 0, 0},
/* 113*/ {LW_UI_STATE, 0, 0, 0},
/* 114*/ {LW_UI_STATE, 0, 0, 0},
/* 115*/ {LW_UI_STATE, 0, 0, 0},
/* 116*/ {LW_UI_STATE, 0, sd_card_rw, 0},
/* 117*/ {LW_UI_STATE, 0, 0, 0},
/* 118*/ {LW_UI_STATE, 0, 0, 0},
/* 119*/ {LW_THERAPY_STATE, 0, legacy_wand_read_adc_values, 0},
/* 120*/ {LW_THERAPY_STATE, 0, 0, 0},
/* 121*/ {LW_THERAPY_STATE, 0, 0, 0},
/* 122*/ {LW_UI_STATE, 0, legacy_wand_therapy_off, 0},
/* 123*/ {LW_UI_STATE, 0, legacy_wand_therapy_off, 0},
/* 124*/ {LW_UI_STATE, 0, legacy_wand_therapy_off, 0},
/* 125*/ {LW_UI_STATE, 0, 0, 0},
/* 126*/ {LW_THERAPY_STATE, 0, legacy_irms_adc_result, 0},
/* 127*/ {LW_THERAPY_STATE, 0, legacy_irms_over_energy, 0}, //legacy_irms_over_energy
/* 128*/ {LW_UI_STATE, 0, 0, 0},
/* 129*/ {LW_UI_STATE, 0, 0, 0},
/* 130*/ {LW_UI_STATE, 0, legacy_wand_disconnected_error, legacy_wand_therapy_off},
/* 131*/ {LW_THERAPY_STATE, 0, legacy_wand_adc_fault, legacy_wand_therapy_off}, 
/* 132*/ {LW_THERAPY_STATE, 0, 0, 0},
/* 133*/ {LW_THERAPY_STATE, 0, 0, 0},
/* 134 */ {LW_THERAPY_STATE, 0, 0, 0}, //Even if wand is expired current on going therapy is not interrupted
/* 135 */ {LW_UI_STATE, 0, lw_ambient_sensor, legacy_wand_therapy_off},
/* 136*/ {LW_THERAPY_STATE, 0, 0, 0},
/* 137*/ {LW_THERAPY_STATE, 0, 0, 0},
/* 138*/ {LW_THERAPY_STATE, 0, log2sdhc, 0},
/* 139*/ {LW_THERAPY_STATE, 0, lw_id_error, 0},
/* 140*/ {LW_THERAPY_STATE, 0, 0, 0},
/* 141*/ {LW_THERAPY_STATE, 0, 0, 0},
/* 142*/ {FAULT_STATE, 0, gen_com_fault, legacy_wand_therapy_off},
/* 143*/ {LW_THERAPY_STATE, 0, 0, 0},
/* 144*/ {LW_THERAPY_STATE, 0, 0, 0},
/* 145*/ {FAULT_STATE, 0, ui_fault, 0},
/* 146*/ {LW_THERAPY_STATE, 0, pump_cmd_eack, 0},
/* 147*/ {LW_THERAPY_STATE, 0, cbtmr_isr, 0},
/* 148*/ {LW_UI_STATE, 0, legacy_wand_disconnected_error, legacy_wand_therapy_off},
/* 149*/ {LW_THERAPY_STATE, 0, 0, 0},
/* 150*/ {LW_THERAPY_STATE, 0, bdm_poll_usb, 0},
/* 151*/ {LW_THERAPY_STATE, 0, 0, 0},

   }   
};


/***************************************************************************//**
Main program loop. The background loop and the state machine reside here.
@param void
@return 0
@outputs
@context
*******************************************************************************/
volatile event eventful;
#ifndef TEST
__root void main(void)
#else
void app_main (void)
#endif
{    

  // setup HW watch dog
  // Setup polling interrupt for STARTUP_STATE
  // 
  current_state = POWERUP_STATE;
  static state_object state_exec;
  uint8_t transition_flag;
#ifndef TEST
  while(1)
  {
#endif 
   // evt_tbl is the variable that is shared between the synchronous and the
    // asynchronous space
   
    event e = get_event (&evt_tbl);    
    
    if(e != NULL_EVENT) //If it is not a NULL_EVENT, go through the SM
    {
      eventful = e;          
      state_exec = state_matrix[current_state][e];
      
      if (state_exec.action != 0)
      {
      transition_flag = (*state_exec.action)();
      }
            
      if (transition_flag == 1)
      {
        //Switch States
        // Can add entry and exit function if we need
        if (state_exec.exit != 0)
        {
        (*state_exec.exit)();
        }
       
        if (state_exec.next_state != current_state)
        {
          current_state = state_exec.next_state;
          state_exec = state_matrix[current_state][NULL_EVENT];
          if (state_exec.entry != 0)
          { 
          (*state_exec.entry)();
          }
        }
        transition_flag = 0;
        
      }
    }
            
    notification_manager();
    profile_manager();
    
#ifndef TEST  
  }
#endif
} /* end main */


/***************************************************************************//**
Transitions the state machine from other states to IDLE_STATE
@none
@return 1
@outputs
@context: This function is called during the entry into IDLE_STATE
*******************************************************************************/
uint8_t IDLE_state_entry (void)
{
  return 1;
}



